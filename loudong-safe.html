<!DOCTYPE HTML><html><head><meta charset="utf-8"><title>为什么一个文件可以修复多个不同文件的漏洞 | 安全天使&#39;Blog</title><meta name="author" content="Angel"><meta name="description" content="由于之前有站长说我不相信你就用了一个XX文件就能够把漏洞给我修复了。好吧，我就在这里解释下为什么一个文件可以修复多个不同文件的漏洞。"><meta name="keywords" content="漏洞修复"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta property="og:title" content="为什么一个文件可以修复多个不同文件的漏洞"/><meta property="og:site_name" content="安全天使&#39;Blog"/><meta property="og:image" content="undefined"/><link rel="alternative" href="/atom.xml" title="安全天使&#39;Blog" type="application/atom+xml"><link href="/favicon.jpg" rel="icon"><link href="http://libs.baidu.com/bootstrap/3.0.3/css/bootstrap.min.css" rel="stylesheet"><link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css"><link rel="stylesheet" href="/css/style.css" media="screen" type="text/css"><link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css"><link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css"><link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css"><link rel="stylesheet" href="/css/sidenav.css" media="screen" type="text/css"><script type="text/javascript" src="http://lib.sinaapp.com/js/jquery/1.8/jquery.min.js"></script><script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script></head><body id="body" data-spy="scroll" data-target=".toc"><div class="container" id="container">	<div class="content">	<div class="page-header"><h1><a class="brand" href="/">Go Back</a><span class="split"></span><span class="title">为什么一个文件可以修复多个不同文件的漏洞</h1></div><span class="date" id="title-date"><strong><i class="fa fa-clock-o"></i>1月 10 2014</strong></span>		<div class="row page">  		<div class="col-md-12">		<p>由于之前有站长说我不相信你就用了一个XX文件就能够把漏洞给我修复了。<br>好吧，我就在这里解释下为什么一个文件可以修复多个不同文件的漏洞。<br><img src="http://p0.qhimg.com/t0199f04936589cff42.jpg" alt="漏洞修复"><br>首先，我们需要知道的是网站的目录结构和文件联系。<br>一般我们都知道网站都会有一些配置文件.<br>常用PHP建站系统的公用页面</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">PHPCMS ：      \phpcms\base.php</div><div class="line">PHPWIND：     \phpwind\conf\baseconfig.php</div><div class="line">DEDECMS：     \data\common.inc.php</div><div class="line">Discuz：           \config\config_global.php</div><div class="line">Wordpress：    \wp-config-sample.php</div><div class="line">ECshop：         \data\config.php</div><div class="line">Metinfo：         \include\head.php</div><div class="line">HDwiki：          \config.php</div></pre></td></tr></table></figure>

<p>上面的这些文件都是网站的公共文件，里面基本都是数据库配置和网站相关配置。<br>那么我们又是如何使用一个文件修复漏洞的呢？<br>我们看看下面的这些代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="preprocessor">&lt;?php</span></div><div class="line">define(<span class="string">'IN_SMT'</span>, <span class="keyword">true</span>);</div><div class="line">define(<span class="string">'IN_MYMPS'</span>, <span class="keyword">true</span>);</div><div class="line">define(<span class="string">'CURSCRIPT'</span>,<span class="string">'index'</span>);</div><div class="line"></div><div class="line"><span class="keyword">require_once</span> dirname(<span class="keyword">__FILE__</span>).<span class="string">"/include/global.php"</span>;</div><div class="line"><span class="keyword">require_once</span> dirname(<span class="keyword">__FILE__</span>).<span class="string">"/data/config.php"</span>;</div><div class="line"></div><div class="line">ifsiteopen();</div><div class="line"><span class="keyword">require_once</span> MYMPS_DATA.<span class="string">"/config.db.php"</span>;</div><div class="line"><span class="keyword">require_once</span> MYMPS_INC.<span class="string">"/db.class.php"</span>;</div><div class="line"><span class="keyword">require_once</span> MYMPS_SMARTY.<span class="string">"/include.php"</span>;</div></pre></td></tr></table></figure>

<p>我们这里可以看到首页文件加载了多个PHP文件，其中/config.db.php这个文件，我们来看看他的代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="preprocessor">&lt;?php</span></div><div class="line"><span class="variable">$charset</span>    = <span class="string">"gbk"</span>;<span class="comment">//系统字符集编码</span></div><div class="line"><span class="variable">$dbcharset</span> = <span class="string">"gbk"</span>;<span class="comment">//数据库字符集编码</span></div><div class="line"><span class="variable">$db_host</span>    = <span class="string">"localhost"</span>;<span class="comment">//数据库服务器地址，一般为localhost</span></div><div class="line"><span class="variable">$db_name</span>    = <span class="string">"*********7"</span>;<span class="comment">//使用的数据库名称</span></div><div class="line"><span class="variable">$db_user</span>    = <span class="string">"********7"</span>;<span class="comment">//数据库帐号</span></div><div class="line"><span class="variable">$db_pass</span>    = <span class="string">"9******00"</span>;<span class="comment">//数据库密码</span></div><div class="line"><span class="variable">$db_mymps</span>   = <span class="string">"my_"</span>;<span class="comment">//数据库前缀</span></div><div class="line"><span class="variable">$db_intype</span>  = <span class="string">""</span>;</div><div class="line"><span class="variable">$cookiepre</span> = <span class="string">"y8***_"</span>;<span class="comment">//cookies加密前缀</span></div><div class="line"><span class="variable">$cookiedomain</span> = <span class="string">"**********.net"</span>;</div><div class="line"><span class="variable">$cookiepath</span> = <span class="string">"/"</span>;</div><div class="line"><span class="preprocessor">?&gt;</span></div></pre></td></tr></table></figure>


<p>这个文件是系统的数据库配置文件，这个程序的所有文件都会加载这个文件才能正常的查询和写入信息。那么我们在来说说漏洞的产生原因，漏洞不管是注入还是XSS还是其他的，绝大部分都是因为用户的输入信息而产生的，我们就拿XSS来说，大家都知道网站很多都有留言板，留言板一般都有几个用户输入的地方，用户名、邮件地址、电话、地址、留言内容等等，在这几个地方我们可以利用这些输入来加入比如：xss/数据查询这里就有一个前提条件就是需要查询或者写入数据库，不然后台管理员是无法看到留言的，假如我们这里没有对用户输入的信息做任何的处理直接带入到数据库查询或者写入数据库，那么我们的网站就可能被黑客入侵，那么我们现在再回到起点，来说说为什么一个文件就能够修复漏洞，首先我们已经知道了，漏洞产生的原因，那么我们就可以在数据库配置文件中调用我们的防护脚本，防护脚本的作用就是对用户所提交的数据进行检测，如果用户所写入或者查询的数据信息存在危险信息，那么这是防护脚本就能够在数据库返回信息之前拦截掉。这样也就达到了修复漏洞的作用。写这篇文章，我希望有些站长能够明白，什么是数据拦截，什么是函数处理。</p>
<div class="bdsharebuttonbox"><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a><a href="#" class="bds_tqq" data-cmd="tqq" title="分享到腾讯微博"></a><a href="#" class="bds_renren" data-cmd="renren" title="分享到人人网"></a><a href="#" class="bds_bdhome" data-cmd="bdhome" title="分享到百度新首页"></a><a href="#" class="bds_tieba" data-cmd="tieba" title="分享到百度贴吧"></a><a href="#" class="bds_mshare" data-cmd="mshare" title="分享到一键分享"></a><a href="#" class="bds_print" data-cmd="print" title="分享到打印"></a><a href="#" class="bds_copy" data-cmd="copy" title="分享到复制网址"></a></div>&nbsp;<div class="tucao">❐ 热评文章：<br /><div class="ds-top-threads" data-range="monthly" data-num-items="8"></div><div class="urlid"> &nbsp;&nbsp;[ <a href="" target="_blank">为什么一个文件可以修复多个不同文件的漏洞</a> ]由Angel发表在 <a href="/">安全天使</a><br />&nbsp; [ 引用地址 ]：http://www.weshell.net/loudong-safe.html</div></div>
<div class="ds-thread" data-title="为什么一个文件可以修复多个不同文件的漏洞" data-url="http://www.weshell.net/loudong-safe.html"></div><script type="text/javascript">var duoshuoQuery = {short_name:"webshellhost"};(function() {    var ds = document.createElement('script');    ds.type = 'text/javascript';ds.async = true;    ds.src = 'http://static.duoshuo.com/embed.js';    ds.charset = 'UTF-8';    (document.getElementsByTagName('head')[0]    || document.getElementsByTagName('body')[0]).appendChild(ds);})();</script>
	</div></div><div class="container-narrow">	<footer>
<script>var _hmt = _hmt || [];(function() {  var hm = document.createElement("script");  hm.src = "//hm.baidu.com/hm.js?248313087381630ea1a3caba0e789997";  var s = document.getElementsByTagName("script")[0];   s.parentNode.insertBefore(hm, s);})();</script>
<SCRIPT language=javascript>function g(formname)	{var url = "http://www.baidu.com/baidu";if (formname.s[1].checked) {	formname.ct.value = "2097152";}else {	formname.ct.value = "0";}formname.action = url;return true;}</SCRIPT><center><form name="f1" onsubmit="return g(this)" target="_blank"><table bgcolor="#FFFFFF" style="font-size:9pt;"><tr height="60"><td valign="top"></td><td><input name=word size="35" maxlength="100" style="width: 210px;height: 24px;line-height: 24px;font: 14px arial;padding: 2px 5px;margin-right: 3px;border: 2px solid black;outline: 0;vertical-align: middle;margin-top:-27px;"><input type="submit" value="Scan" style="width: 66px;height: 24px;border: 0;color: #ccc;background: black;font-weight: bold;font: bold 14px arial;padding: 0;padding-top: 1px;margin-top:-27px;cursor: pointer;vertical-align: middle;"><br><input name=tn type=hidden value="bds"><input name=cl type=hidden value="3"><input name=ct type=hidden><input name=si type=hidden value="www.weshell.net"><input name=s type=radio style="display:none;"><input name=s type=radio checked style="display:none;"></td></tr></table></form>
<div class="weshell"><font size="0.4em"><strong>[ &copy; 2006-2013 <a href="http://www.weshell.net">安全天使&Angel</a> ] -  [<a href="http://www.miitbeian.gov.cn" target="_blank"> 鄂ICP备105632号-1</a> ] - [<a href="/atom.xml"> RSS源</a> - <a href="/baidusitemap.xml">引擎地图</a> - <a href="https://i0yy.com" target="_blank">自建社工库</a> ]</div>
<script language="javascript" type="text/javascript" src="http://quote.51.la/?id=17600924&amp;mb=3"></script></font></strong></center><div style="display:none"><script language="javascript" type="text/javascript" src="http://js.users.51.la/17600924.js"></script></div>
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"2","bdSize":"16"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>


</footer></div><a id="gotop" href="#"><span>▲</span></a><script src="/js/jquery.imagesloaded.min.js"></script><script src="/js/gallery.js"></script><script src="http://libs.baidu.com/bootstrap/3.0.3/js/bootstrap.min.js"></script><script src="/js/jquery.tableofcontents.min.js"></script><script src="/js/tocgenerator.min.js"></script><script src="/js/main.js"></script><link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css"><script src="/fancybox/jquery.fancybox.pack.js"></script><script type="text/javascript">(function($){  $('.fancybox').fancybox();})(jQuery);</script></body></html>